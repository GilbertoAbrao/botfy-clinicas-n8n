[
  {
    "type": "text",
    "text": "{\n  \"success\": true,\n  \"data\": {\n    \"updatedAt\": \"2026-01-14T20:02:00.000Z\",\n    \"createdAt\": \"2026-01-12T23:38:36.781Z\",\n    \"id\": \"HTR3ITfFDrK6eP2R\",\n    \"name\": \"Botfy - Anti No-Show\",\n    \"description\": null,\n    \"active\": true,\n    \"isArchived\": false,\n    \"nodes\": [\n      {\n        \"parameters\": {\n          \"rule\": {\n            \"interval\": [\n              {\n                \"field\": \"minutes\",\n                \"minutesInterval\": 15\n              }\n            ]\n          }\n        },\n        \"id\": \"schedule-trigger\",\n        \"name\": \"Verifica Consultas\",\n        \"type\": \"n8n-nodes-base.scheduleTrigger\",\n        \"typeVersion\": 1.2,\n        \"position\": [\n          -1200,\n          304\n        ]\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"getAll\",\n          \"tableId\": \"config_lembretes\",\n          \"returnAll\": true,\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"ativo\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"true\"\n              }\n            ]\n          }\n        },\n        \"id\": \"config-lembretes\",\n        \"name\": \"Busca Config Lembretes\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          -1008,\n          304\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"getAll\",\n          \"tableId\": \"agendamentos_completos\",\n          \"returnAll\": true,\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"data_hora\",\n                \"condition\": \"gte\",\n                \"keyValue\": \"={{ $now.toISO() }}\"\n              },\n              {\n                \"keyName\": \"data_hora\",\n                \"condition\": \"lte\",\n                \"keyValue\": \"={{ $now.plus({ hours: 48 }).toISO() }}\"\n              },\n              {\n                \"keyName\": \"status\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"agendada\"\n              }\n            ]\n          }\n        },\n        \"id\": \"google-calendar\",\n        \"name\": \"Busca Agendamentos 48h\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          -800,\n          304\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {},\n        \"id\": \"merge-data\",\n        \"name\": \"Combina Dados\",\n        \"type\": \"n8n-nodes-base.merge\",\n        \"typeVersion\": 3,\n        \"position\": [\n          -608,\n          304\n        ]\n      },\n      {\n        \"parameters\": {\n          \"assignments\": {\n            \"assignments\": [\n              {\n                \"id\": \"consulta-id\",\n                \"name\": \"consulta_id\",\n                \"value\": \"={{ $json.id }}\",\n                \"type\": \"number\"\n              },\n              {\n                \"id\": \"paciente-nome\",\n                \"name\": \"paciente_nome\",\n                \"value\": \"={{ $json.paciente_nome }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"paciente-tel\",\n                \"name\": \"paciente_telefone\",\n                \"value\": \"={{ $json.paciente_telefone }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"paciente-email\",\n                \"name\": \"paciente_email\",\n                \"value\": \"={{ $json.paciente_email || '' }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"evento-inicio\",\n                \"name\": \"consulta_inicio\",\n                \"value\": \"={{ $json.data_hora }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"tipo-consulta\",\n                \"name\": \"tipo_consulta\",\n                \"value\": \"={{ $json.tipo_consulta }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"profissional\",\n                \"name\": \"profissional\",\n                \"value\": \"={{ $json.profissional }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"horas-restantes\",\n                \"name\": \"horas_ate_consulta\",\n                \"value\": \"={{ Math.round((new Date($json.data_hora).getTime() - Date.now()) / (1000 * 60 * 60) * 100) / 100 }}\",\n                \"type\": \"number\"\n              },\n              {\n                \"id\": \"config-nome\",\n                \"name\": \"config_lembrete_nome\",\n                \"value\": \"={{ $json.config_nome || $('Busca Config Lembretes').item.json.nome }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"config-horas\",\n                \"name\": \"config_horas_antes\",\n                \"value\": \"={{ $json.config_horas_antes || $('Busca Config Lembretes').item.json.horas_antes }}\",\n                \"type\": \"number\"\n              },\n              {\n                \"id\": \"config-template\",\n                \"name\": \"config_template_tipo\",\n                \"value\": \"={{ $json.config_template_tipo || $('Busca Config Lembretes').item.json.template_tipo }}\",\n                \"type\": \"string\"\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"calcula-tempo\",\n        \"name\": \"Calcula Tempo Restante\",\n        \"type\": \"n8n-nodes-base.set\",\n        \"typeVersion\": 3.4,\n        \"position\": [\n          -400,\n          304\n        ]\n      },\n      {\n        \"parameters\": {\n          \"conditions\": {\n            \"options\": {\n              \"version\": 2,\n              \"leftValue\": \"\",\n              \"caseSensitive\": true,\n              \"typeValidation\": \"strict\"\n            },\n            \"conditions\": [\n              {\n                \"id\": \"cond-timing\",\n                \"leftValue\": \"={{ $json.horas_ate_consulta }}\",\n                \"rightValue\": \"={{ $json.config_horas_antes }}\",\n                \"operator\": {\n                  \"type\": \"number\",\n                  \"operation\": \"lte\"\n                }\n              },\n              {\n                \"id\": \"cond-timing-min\",\n                \"leftValue\": \"={{ $json.horas_ate_consulta }}\",\n                \"rightValue\": \"={{ $json.config_horas_antes - 2 }}\",\n                \"operator\": {\n                  \"type\": \"number\",\n                  \"operation\": \"gte\"\n                }\n              }\n            ],\n            \"combinator\": \"and\"\n          },\n          \"options\": {}\n        },\n        \"id\": \"if-timing\",\n        \"name\": \"Timing Correto?\",\n        \"type\": \"n8n-nodes-base.if\",\n        \"typeVersion\": 2.2,\n        \"position\": [\n          -208,\n          304\n        ]\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"getAll\",\n          \"tableId\": \"historico_noshow\",\n          \"returnAll\": true,\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"telefone\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"={{ $('Calcula Tempo Restante').item.json.paciente_email }}\"\n              }\n            ]\n          }\n        },\n        \"id\": \"busca-historico\",\n        \"name\": \"Busca Historico Paciente\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          400,\n          112\n        ],\n        \"alwaysOutputData\": true,\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"assignments\": {\n            \"assignments\": [\n              {\n                \"id\": \"dados-paciente\",\n                \"name\": \"dados_paciente\",\n                \"value\": \"={{ JSON.stringify($('Calcula Tempo Restante').item.json) }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"historico\",\n                \"name\": \"historico_noshow\",\n                \"value\": \"={{ $json.length > 0 ? 'Total consultas: ' + $json.length + ', Faltas: ' + $json.filter(h => !h.compareceu).length : 'Sem historico' }}\",\n                \"type\": \"string\"\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"prepara-analise\",\n        \"name\": \"Prepara Dados Analise\",\n        \"type\": \"n8n-nodes-base.set\",\n        \"typeVersion\": 3.4,\n        \"position\": [\n          608,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"modelId\": {\n            \"__rl\": true,\n            \"value\": \"gpt-4.1-mini\",\n            \"mode\": \"list\"\n          },\n          \"messages\": {\n            \"values\": [\n              {\n                \"content\": \"Voce e um analista de risco de no-show para clinica de estetica.\\n\\nAnalise o risco deste paciente faltar na consulta.\\n\\nDados do paciente e consulta:\\n{{ $json.dados_paciente }}\\n\\nHistorico do paciente:\\n{{ $json.historico_noshow }}\\n\\nRegras de analise:\\n- Sexta-feira tarde: +20% risco\\n- Segunda-feira manha: +10% risco\\n- Paciente sem historico: risco medio (0.3)\\n- Cada falta anterior: +15% risco\\n- Consulta de retorno: -10% risco\\n\\nRetorne APENAS um JSON valido (sem markdown):\\n{\\\"risco\\\": 0.0 a 1.0, \\\"fatores\\\": [\\\"fator1\\\", \\\"fator2\\\"], \\\"recomendacao\\\": \\\"lembrete_normal\\\" ou \\\"lembrete_reforcado\\\" ou \\\"ligar_antes\\\"}\"\n              }\n            ]\n          },\n          \"options\": {\n            \"temperature\": 0.3\n          }\n        },\n        \"id\": \"analise-risco\",\n        \"name\": \"IA Analisa Risco No-Show\",\n        \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n        \"typeVersion\": 1.8,\n        \"position\": [\n          784,\n          112\n        ],\n        \"credentials\": {\n          \"openAiApi\": {\n            \"id\": \"b2f06NWMfx9VK1I2\",\n            \"name\": \"OpenAi account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"assignments\": {\n            \"assignments\": [\n              {\n                \"id\": \"risco-obj\",\n                \"name\": \"analise_risco\",\n                \"value\": \"={{ JSON.parse($json.message.content) }}\",\n                \"type\": \"object\"\n              },\n              {\n                \"id\": \"risco-score\",\n                \"name\": \"risco_score\",\n                \"value\": \"={{ JSON.parse($json.message.content).risco }}\",\n                \"type\": \"number\"\n              },\n              {\n                \"id\": \"dados-evento\",\n                \"name\": \"evento\",\n                \"value\": \"={{ $('Calcula Tempo Restante').item.json }}\",\n                \"type\": \"object\"\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"parse-risco\",\n        \"name\": \"Extrai Score Risco\",\n        \"type\": \"n8n-nodes-base.set\",\n        \"typeVersion\": 3.4,\n        \"position\": [\n          1056,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"modelId\": {\n            \"__rl\": true,\n            \"value\": \"gpt-4.1-mini\",\n            \"mode\": \"list\",\n            \"cachedResultName\": \"GPT-4.1-MINI\"\n          },\n          \"messages\": {\n            \"values\": [\n              {\n                \"content\": \"Voce e Marilia, assistente da Dra. Paula. Gere uma mensagem de lembrete HUMANIZADA para o paciente.\\n\\nDados:\\n- Nome: {{ $json.nome }}\\n- Consulta: {{ $json.tipo_consulta || 'consulta' }}\\n- Data: {{ $json.data_formatada }}\\n- Horario: {{ $json.horario }}\\n- Tipo de lembrete: {{ $json.tipo_lembrete }}\\n\\nREGRAS IMPORTANTES:\\n- NUNCA use frases como 'Responda X ou Y' ou 'Digite CONFIRMAR'\\n- Seja natural e acolhedora como uma secretaria real\\n- Use no maximo 2 emojis\\n- Maximo 3 frases curtas\\n- Se for lembrete_2h, seja mais direta pois a consulta e em breve\\n- Se for lembrete_24h ou 48h, pode ser mais casual\\n\\nExemplos de tom correto:\\n- 'Oi Joao! Passando pra lembrar da sua consulta amanha as 10h com a Dra. Paula. Nos vemos la! 游땕'\\n- 'Gilberto, sua consulta e daqui a pouquinho, as 15h! Qualquer coisa me avisa aqui. Ate ja!'\\n\\nGere apenas a mensagem, sem explicacoes.\"\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"gera-mensagem\",\n        \"name\": \"IA Gera Mensagem\",\n        \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n        \"typeVersion\": 1.8,\n        \"position\": [\n          1200,\n          112\n        ],\n        \"credentials\": {\n          \"openAiApi\": {\n            \"id\": \"b2f06NWMfx9VK1I2\",\n            \"name\": \"OpenAi account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"assignments\": {\n            \"assignments\": [\n              {\n                \"id\": \"telefone\",\n                \"name\": \"telefone\",\n                \"value\": \"={{ $('Calcula Tempo Restante').item.json.paciente_telefone }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"mensagem\",\n                \"name\": \"mensagem\",\n                \"value\": \"={{ $json.message.content }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"consulta-id-final\",\n                \"name\": \"consulta_id\",\n                \"value\": \"={{ $('Calcula Tempo Restante').item.json.consulta_id }}\",\n                \"type\": \"number\"\n              },\n              {\n                \"id\": \"tipo-lembrete\",\n                \"name\": \"tipo_lembrete\",\n                \"value\": \"={{ $('Calcula Tempo Restante').item.json.config_lembrete_nome }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"risco-final\",\n                \"name\": \"risco_score\",\n                \"value\": \"={{ $('Extrai Score Risco').item.json.risco_score }}\",\n                \"type\": \"number\"\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"prepara-envio\",\n        \"name\": \"Prepara Envio WhatsApp\",\n        \"type\": \"n8n-nodes-base.set\",\n        \"typeVersion\": 3.4,\n        \"position\": [\n          1472,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"method\": \"POST\",\n          \"url\": \"={{ $('Vari치veis Globais').first().json.api_url }}/message/sendText/{{ $('Vari치veis Globais').first().json.instancia }}\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"apikey\",\n                \"value\": \"={{ $('Vari치veis Globais').first().json.api_key }}\"\n              }\n            ]\n          },\n          \"sendBody\": true,\n          \"specifyBody\": \"json\",\n          \"jsonBody\": \"={\\n    \\\"number\\\": \\\"{{ $json.telefone }}\\\",\\n    \\\"text\\\": \\\"{{ $json.mensagem.replace(/\\\\n/g, \\\"\\\\\\\\n\\\").replace(/['\\\"]/g, '') }}\\\",\\n    \\\"delay\\\": 2000\\n}\",\n          \"options\": {}\n        },\n        \"id\": \"envia-whatsapp\",\n        \"name\": \"Envia WhatsApp\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          1600,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"tableId\": \"lembretes_enviados\",\n          \"fieldsUi\": {\n            \"fieldValues\": [\n              {\n                \"fieldId\": \"agendamento_id\",\n                \"fieldValue\": \"={{ $('Busca Agendamentos 48h').item.json.id }}\"\n              },\n              {\n                \"fieldId\": \"telefone\",\n                \"fieldValue\": \"={{ $('Busca Agendamentos 48h').item.json.paciente_telefone }}\"\n              },\n              {\n                \"fieldId\": \"tipo_lembrete\",\n                \"fieldValue\": \"={{ $('Busca Config Lembretes').item.json.nome }}\"\n              },\n              {\n                \"fieldId\": \"mensagem_enviada\",\n                \"fieldValue\": \"={{ $('IA Gera Mensagem').item.json.message.content }}\"\n              },\n              {\n                \"fieldId\": \"risco_noshow\",\n                \"fieldValue\": \"={{ $('Extrai Score Risco').item.json.risco }}\"\n              }\n            ]\n          }\n        },\n        \"id\": \"registra-lembrete\",\n        \"name\": \"Registra Lembrete Enviado\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          1808,\n          112\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"content\": \"## Botfy - Anti No-Show\\nVerifica consultas proximas e envia lembretes inteligentes\",\n          \"height\": 100,\n          \"width\": 400,\n          \"color\": 4\n        },\n        \"id\": \"sticky-titulo\",\n        \"name\": \"Sticky Note\",\n        \"type\": \"n8n-nodes-base.stickyNote\",\n        \"position\": [\n          -1664,\n          304\n        ],\n        \"typeVersion\": 1\n      },\n      {\n        \"parameters\": {\n          \"content\": \"## Analise de Risco IA\\nCalcula probabilidade de no-show\",\n          \"height\": 80,\n          \"width\": 300,\n          \"color\": 2\n        },\n        \"id\": \"sticky-analise\",\n        \"name\": \"Sticky Note1\",\n        \"type\": \"n8n-nodes-base.stickyNote\",\n        \"position\": [\n          752,\n          -48\n        ],\n        \"typeVersion\": 1\n      },\n      {\n        \"parameters\": {\n          \"content\": \"## Envio e Registro\\nWhatsApp + Supabase\",\n          \"height\": 80,\n          \"width\": 300,\n          \"color\": 6\n        },\n        \"id\": \"sticky-envio\",\n        \"name\": \"Sticky Note2\",\n        \"type\": \"n8n-nodes-base.stickyNote\",\n        \"position\": [\n          1360,\n          -48\n        ],\n        \"typeVersion\": 1\n      },\n      {\n        \"parameters\": {\n          \"httpMethod\": \"POST\",\n          \"path\": \"anti-noshow-resposta\",\n          \"options\": {}\n        },\n        \"id\": \"webhook-resposta\",\n        \"name\": \"Webhook Resposta Paciente\",\n        \"type\": \"n8n-nodes-base.webhook\",\n        \"typeVersion\": 2,\n        \"position\": [\n          -1200,\n          704\n        ],\n        \"webhookId\": \"anti-noshow-webhook-001\"\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"// Extrai dados da resposta do Evolution API\\n// Busca dados do webhook diretamente pelo nome do node\\nconst webhookData = $('Webhook Resposta Paciente').first().json;\\nconst body = webhookData.body || {};\\nconst nestedBody = body.body || body;\\n\\n// Busca credenciais das Vari치veis Globais\\nconst config = $input.first().json;\\n\\n// Tenta extrair telefone de diferentes estruturas\\nlet telefone = '';\\nif (nestedBody.data && nestedBody.data.key && nestedBody.data.key.remoteJid) {\\n  telefone = nestedBody.data.key.remoteJid.replace('@s.whatsapp.net', '');\\n}\\n\\n// Tenta extrair mensagem\\nlet mensagem = '';\\nif (nestedBody.data && nestedBody.data.message) {\\n  mensagem = nestedBody.data.message.conversation || \\n             (nestedBody.data.message.extendedTextMessage && nestedBody.data.message.extendedTextMessage.text) || \\n             '';\\n}\\n\\nreturn [{\\n  json: {\\n    telefone,\\n    mensagem,\\n    instancia: config.instancia || nestedBody.instance || '',\\n    api_url: config.api_url || '',\\n    api_key: config.api_key || ''\\n  }\\n}];\"\n        },\n        \"id\": \"extrai-dados-resposta\",\n        \"name\": \"Extrai Dados Resposta\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          -1008,\n          704\n        ]\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"getAll\",\n          \"tableId\": \"lembretes_enviados\",\n          \"limit\": 1,\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"telefone\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"={{ $json.telefone }}\"\n              },\n              {\n                \"keyName\": \"status_resposta\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"pendente\"\n              }\n            ]\n          }\n        },\n        \"id\": \"busca-lembrete-pendente\",\n        \"name\": \"Busca Lembrete Pendente\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          -800,\n          704\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"conditions\": {\n            \"options\": {\n              \"version\": 2,\n              \"leftValue\": \"\",\n              \"caseSensitive\": true,\n              \"typeValidation\": \"loose\"\n            },\n            \"conditions\": [\n              {\n                \"id\": \"cond-lembrete\",\n                \"leftValue\": \"={{ $json.id }}\",\n                \"rightValue\": \"\",\n                \"operator\": {\n                  \"type\": \"number\",\n                  \"operation\": \"exists\"\n                }\n              }\n            ],\n            \"combinator\": \"and\"\n          },\n          \"looseTypeValidation\": true,\n          \"options\": {}\n        },\n        \"id\": \"if-tem-lembrete\",\n        \"name\": \"Tem Lembrete Pendente?\",\n        \"type\": \"n8n-nodes-base.if\",\n        \"typeVersion\": 2.2,\n        \"position\": [\n          -608,\n          704\n        ]\n      },\n      {\n        \"parameters\": {\n          \"modelId\": {\n            \"__rl\": true,\n            \"value\": \"gpt-4.1-mini\",\n            \"mode\": \"list\"\n          },\n          \"messages\": {\n            \"values\": [\n              {\n                \"content\": \"=Voce e um assistente que interpreta respostas de pacientes sobre confirmacao de consulta.\\n\\nMensagem do paciente: \\\"{{ $('Extrai Dados Resposta').item.json.mensagem }}\\\"\\n\\nClassifique a resposta em UMA das categorias:\\n- CONFIRMA: paciente confirmou presenca (sim, ok, confirmado, vou, estarei la, etc)\\n- CANCELA: paciente quer cancelar (nao vou, cancela, desmarcar, nao posso, etc)\\n- REAGENDA: paciente quer mudar horario (trocar, remarcar, outro horario, etc)\\n- DUVIDA: paciente tem duvida ou resposta nao clara\\n\\nRetorne APENAS um JSON valido:\\n{\\\"categoria\\\": \\\"CONFIRMA|CANCELA|REAGENDA|DUVIDA\\\", \\\"confianca\\\": 0.0 a 1.0, \\\"resposta_sugerida\\\": \\\"mensagem curta para responder ao paciente\\\"}\"\n              }\n            ]\n          },\n          \"options\": {\n            \"temperature\": 0.2\n          }\n        },\n        \"id\": \"ai-interpreta-resposta\",\n        \"name\": \"IA Interpreta Resposta\",\n        \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n        \"typeVersion\": 1.8,\n        \"position\": [\n          -400,\n          608\n        ],\n        \"credentials\": {\n          \"openAiApi\": {\n            \"id\": \"b2f06NWMfx9VK1I2\",\n            \"name\": \"OpenAi account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"assignments\": {\n            \"assignments\": [\n              {\n                \"id\": \"categoria\",\n                \"name\": \"categoria\",\n                \"value\": \"={{ JSON.parse($json.message.content).categoria }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"confianca\",\n                \"name\": \"confianca\",\n                \"value\": \"={{ JSON.parse($json.message.content).confianca }}\",\n                \"type\": \"number\"\n              },\n              {\n                \"id\": \"resposta-sugerida\",\n                \"name\": \"resposta_sugerida\",\n                \"value\": \"={{ JSON.parse($json.message.content).resposta_sugerida }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"lembrete-id\",\n                \"name\": \"lembrete_id\",\n                \"value\": \"={{ $('Busca Lembrete Pendente').item.json.id }}\",\n                \"type\": \"number\"\n              },\n              {\n                \"id\": \"consulta-id-resp\",\n                \"name\": \"consulta_id\",\n                \"value\": \"={{ $('Busca Lembrete Pendente').item.json.consulta_id }}\",\n                \"type\": \"number\"\n              },\n              {\n                \"id\": \"telefone-final\",\n                \"name\": \"telefone\",\n                \"value\": \"={{ $('Extrai Dados Resposta').item.json.telefone }}\",\n                \"type\": \"string\"\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"parse-categoria\",\n        \"name\": \"Extrai Categoria\",\n        \"type\": \"n8n-nodes-base.set\",\n        \"typeVersion\": 3.4,\n        \"position\": [\n          -208,\n          608\n        ]\n      },\n      {\n        \"parameters\": {\n          \"rules\": {\n            \"values\": [\n              {\n                \"conditions\": {\n                  \"options\": {\n                    \"caseSensitive\": true,\n                    \"leftValue\": \"\",\n                    \"typeValidation\": \"strict\",\n                    \"version\": 2\n                  },\n                  \"conditions\": [\n                    {\n                      \"id\": \"cond-confirma\",\n                      \"leftValue\": \"={{ $json.categoria }}\",\n                      \"rightValue\": \"CONFIRMA\",\n                      \"operator\": {\n                        \"type\": \"string\",\n                        \"operation\": \"equals\"\n                      }\n                    }\n                  ],\n                  \"combinator\": \"and\"\n                },\n                \"renameOutput\": true,\n                \"outputKey\": \"CONFIRMA\"\n              },\n              {\n                \"conditions\": {\n                  \"options\": {\n                    \"caseSensitive\": true,\n                    \"leftValue\": \"\",\n                    \"typeValidation\": \"strict\",\n                    \"version\": 2\n                  },\n                  \"conditions\": [\n                    {\n                      \"id\": \"cond-cancela\",\n                      \"leftValue\": \"={{ $json.categoria }}\",\n                      \"rightValue\": \"CANCELA\",\n                      \"operator\": {\n                        \"type\": \"string\",\n                        \"operation\": \"equals\"\n                      }\n                    }\n                  ],\n                  \"combinator\": \"and\"\n                },\n                \"renameOutput\": true,\n                \"outputKey\": \"CANCELA\"\n              },\n              {\n                \"conditions\": {\n                  \"options\": {\n                    \"caseSensitive\": true,\n                    \"leftValue\": \"\",\n                    \"typeValidation\": \"strict\",\n                    \"version\": 2\n                  },\n                  \"conditions\": [\n                    {\n                      \"id\": \"cond-reagenda\",\n                      \"leftValue\": \"={{ $json.categoria }}\",\n                      \"rightValue\": \"REAGENDA\",\n                      \"operator\": {\n                        \"type\": \"string\",\n                        \"operation\": \"equals\"\n                      }\n                    }\n                  ],\n                  \"combinator\": \"and\"\n                },\n                \"renameOutput\": true,\n                \"outputKey\": \"REAGENDA\"\n              },\n              {\n                \"conditions\": {\n                  \"options\": {\n                    \"caseSensitive\": true,\n                    \"leftValue\": \"\",\n                    \"typeValidation\": \"strict\",\n                    \"version\": 2\n                  },\n                  \"conditions\": [\n                    {\n                      \"id\": \"cond-duvida\",\n                      \"leftValue\": \"={{ $json.categoria }}\",\n                      \"rightValue\": \"DUVIDA\",\n                      \"operator\": {\n                        \"type\": \"string\",\n                        \"operation\": \"equals\"\n                      }\n                    }\n                  ],\n                  \"combinator\": \"and\"\n                },\n                \"renameOutput\": true,\n                \"outputKey\": \"DUVIDA\"\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"switch-categoria\",\n        \"name\": \"Direciona por Categoria\",\n        \"type\": \"n8n-nodes-base.switch\",\n        \"typeVersion\": 3.2,\n        \"position\": [\n          0,\n          608\n        ]\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"update\",\n          \"tableId\": \"lembretes_enviados\",\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"id\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"={{ $json.lembrete_id }}\"\n              }\n            ]\n          },\n          \"fieldsUi\": {\n            \"fieldValues\": [\n              {\n                \"fieldId\": \"status_resposta\",\n                \"fieldValue\": \"confirmado\"\n              },\n              {\n                \"fieldId\": \"data_resposta\",\n                \"fieldValue\": \"={{ $now.toISO() }}\"\n              }\n            ]\n          }\n        },\n        \"id\": \"atualiza-confirmado\",\n        \"name\": \"Atualiza Status Confirmado\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          256,\n          400\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"update\",\n          \"tableId\": \"lembretes_enviados\",\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"id\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"={{ $json.lembrete_id }}\"\n              }\n            ]\n          },\n          \"fieldsUi\": {\n            \"fieldValues\": [\n              {\n                \"fieldId\": \"status_resposta\",\n                \"fieldValue\": \"cancelado\"\n              },\n              {\n                \"fieldId\": \"data_resposta\",\n                \"fieldValue\": \"={{ $now.toISO() }}\"\n              }\n            ]\n          }\n        },\n        \"id\": \"atualiza-cancelado\",\n        \"name\": \"Atualiza Status Cancelado\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          256,\n          560\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"method\": \"POST\",\n          \"url\": \"={{ $('Vari치veis Globais Webhook').first().json.api_url }}/message/sendText/{{ $('Vari치veis Globais Webhook').first().json.instancia }}\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"apikey\",\n                \"value\": \"={{ $('Vari치veis Globais Webhook').first().json.api_key }}\"\n              }\n            ]\n          },\n          \"sendBody\": true,\n          \"specifyBody\": \"json\",\n          \"jsonBody\": \"={\\n    \\\"number\\\": \\\"{{ $('Extrai Dados Resposta').first().json.telefone }}\\\",\\n    \\\"text\\\": \\\"{{ ($json.resposta || 'Obrigado pela sua resposta!').replace(/\\\\n/g, \\\"\\\\\\\\n\\\").replace(/['\\\"]/g, '') }}\\\",\\n    \\\"delay\\\": 2000\\n}\",\n          \"options\": {}\n        },\n        \"id\": \"responde-paciente\",\n        \"name\": \"Responde Paciente\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          512,\n          512\n        ]\n      },\n      {\n        \"parameters\": {\n          \"content\": \"## Webhook Respostas\\nRecebe confirmacao/cancelamento do paciente\",\n          \"height\": 100,\n          \"width\": 350,\n          \"color\": 5\n        },\n        \"id\": \"sticky-webhook\",\n        \"name\": \"Sticky Note Webhook\",\n        \"type\": \"n8n-nodes-base.stickyNote\",\n        \"typeVersion\": 1,\n        \"position\": [\n          -1632,\n          704\n        ]\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"getAll\",\n          \"tableId\": \"lista_espera\",\n          \"limit\": 3,\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"status\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"aguardando\"\n              }\n            ]\n          }\n        },\n        \"id\": \"busca-lista-espera\",\n        \"name\": \"Busca Lista Espera\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          256,\n          752\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"conditions\": {\n            \"options\": {\n              \"version\": 2,\n              \"leftValue\": \"\",\n              \"caseSensitive\": true,\n              \"typeValidation\": \"strict\"\n            },\n            \"conditions\": [\n              {\n                \"id\": \"cond-espera\",\n                \"leftValue\": \"={{ $json }}\",\n                \"rightValue\": \"\",\n                \"operator\": {\n                  \"type\": \"object\",\n                  \"operation\": \"notEmpty\"\n                }\n              }\n            ],\n            \"combinator\": \"and\"\n          },\n          \"options\": {}\n        },\n        \"id\": \"if-tem-espera\",\n        \"name\": \"Tem Pessoas na Espera?\",\n        \"type\": \"n8n-nodes-base.if\",\n        \"typeVersion\": 2.2,\n        \"position\": [\n          464,\n          752\n        ]\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"getAll\",\n          \"tableId\": \"agendamentos_completos\",\n          \"limit\": 1,\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"id\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"={{ $('Busca Lembrete Pendente').item.json.agendamento_id }}\"\n              }\n            ]\n          }\n        },\n        \"id\": \"busca-evento-cancelado\",\n        \"name\": \"Busca Dados Agendamento\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          656,\n          656\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"assignments\": {\n            \"assignments\": [\n              {\n                \"id\": \"espera-telefone\",\n                \"name\": \"telefone_espera\",\n                \"value\": \"={{ $('Busca Lista Espera').item.json.telefone }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"espera-nome\",\n                \"name\": \"nome_espera\",\n                \"value\": \"={{ $('Busca Lista Espera').item.json.nome }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"espera-id\",\n                \"name\": \"espera_id\",\n                \"value\": \"={{ $('Busca Lista Espera').item.json.id }}\",\n                \"type\": \"number\"\n              },\n              {\n                \"id\": \"consulta-data\",\n                \"name\": \"evento_data\",\n                \"value\": \"={{ $json.data_hora }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"consulta-tipo\",\n                \"name\": \"evento_titulo\",\n                \"value\": \"={{ $json.tipo_consulta }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"consulta-id\",\n                \"name\": \"consulta_id\",\n                \"value\": \"={{ $json.id }}\",\n                \"type\": \"number\"\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"prepara-oferta-vaga\",\n        \"name\": \"Prepara Oferta Vaga\",\n        \"type\": \"n8n-nodes-base.set\",\n        \"typeVersion\": 3.4,\n        \"position\": [\n          864,\n          656\n        ]\n      },\n      {\n        \"parameters\": {\n          \"modelId\": {\n            \"__rl\": true,\n            \"value\": \"gpt-4.1-mini\",\n            \"mode\": \"list\"\n          },\n          \"messages\": {\n            \"values\": [\n              {\n                \"content\": \"=Gere uma mensagem curta oferecendo uma vaga que abriu para um paciente na lista de espera.\\n\\nDados:\\n- Nome do paciente: {{ $json.nome_espera }}\\n- Data/hora da vaga: {{ $json.evento_data }}\\n- Clinica da Dra. Paula\\n\\nRegras:\\n- Maximo 200 caracteres\\n- Tom animado mas profissional\\n- Pedir para responder SIM se quiser a vaga\\n- Mencionar que e por ordem de chegada\\n- Assinar como Marilia\\n\\nRetorne APENAS a mensagem, sem aspas.\"\n              }\n            ]\n          },\n          \"options\": {\n            \"temperature\": 0.7\n          }\n        },\n        \"id\": \"gera-msg-espera\",\n        \"name\": \"IA Gera Mensagem Vaga\",\n        \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n        \"typeVersion\": 1.8,\n        \"position\": [\n          1056,\n          656\n        ],\n        \"credentials\": {\n          \"openAiApi\": {\n            \"id\": \"b2f06NWMfx9VK1I2\",\n            \"name\": \"OpenAi account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"method\": \"POST\",\n          \"url\": \"={{ $('Vari치veis Globais Webhook').first().json.api_url }}/message/sendText/{{ $('Vari치veis Globais Webhook').first().json.instancia }}\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"apikey\",\n                \"value\": \"={{ $('Vari치veis Globais Webhook').first().json.api_key }}\"\n              }\n            ]\n          },\n          \"sendBody\": true,\n          \"specifyBody\": \"json\",\n          \"jsonBody\": \"={\\n    \\\"number\\\": \\\"{{ $json.telefone }}\\\",\\n    \\\"text\\\": \\\"{{ $json.mensagem.replace(/\\\\n/g, \\\"\\\\\\\\n\\\").replace(/['\\\"]/g, '') }}\\\",\\n    \\\"delay\\\": 2000\\n}\",\n          \"options\": {}\n        },\n        \"id\": \"envia-oferta-espera\",\n        \"name\": \"Envia Oferta para Espera\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          1344,\n          656\n        ]\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"update\",\n          \"tableId\": \"lista_espera\",\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"id\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"={{ $('Prepara Oferta Vaga').item.json.espera_id }}\"\n              }\n            ]\n          },\n          \"fieldsUi\": {\n            \"fieldValues\": [\n              {\n                \"fieldId\": \"status\",\n                \"fieldValue\": \"contatado\"\n              },\n              {\n                \"fieldId\": \"data_contato\",\n                \"fieldValue\": \"={{ $now.toISO() }}\"\n              }\n            ]\n          }\n        },\n        \"id\": \"atualiza-espera-contatado\",\n        \"name\": \"Atualiza Espera Contatado\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          1504,\n          656\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"update\",\n          \"tableId\": \"agendamentos\",\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"id\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"={{ $('Busca Lembrete Pendente').item.json.agendamento_id }}\"\n              }\n            ]\n          },\n          \"fieldsUi\": {\n            \"fieldValues\": [\n              {\n                \"fieldId\": \"status\",\n                \"fieldValue\": \"cancelada\"\n              },\n              {\n                \"fieldId\": \"updated_at\",\n                \"fieldValue\": \"={{ $now.toISO() }}\"\n              }\n            ]\n          }\n        },\n        \"id\": \"deleta-evento-calendar\",\n        \"name\": \"Atualiza Agendamento Cancelado\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          464,\n          912\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"content\": \"## Lista de Espera\\nQuando cancela, oferece vaga para quem esta aguardando\",\n          \"height\": 80,\n          \"width\": 448,\n          \"color\": 3\n        },\n        \"id\": \"sticky-lista-espera\",\n        \"name\": \"Sticky Note Lista Espera\",\n        \"type\": \"n8n-nodes-base.stickyNote\",\n        \"typeVersion\": 1,\n        \"position\": [\n          528,\n          400\n        ]\n      },\n      {\n        \"parameters\": {\n          \"rule\": {\n            \"interval\": [\n              {\n                \"field\": \"hours\"\n              }\n            ]\n          }\n        },\n        \"id\": \"schedule-escalacao\",\n        \"name\": \"Verifica Nao Respondidos\",\n        \"type\": \"n8n-nodes-base.scheduleTrigger\",\n        \"typeVersion\": 1.2,\n        \"position\": [\n          -1200,\n          1104\n        ]\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"getAll\",\n          \"tableId\": \"lembretes_enviados\",\n          \"returnAll\": true,\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"status_resposta\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"pendente\"\n              },\n              {\n                \"keyName\": \"escalado_humano\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"false\"\n              }\n            ]\n          }\n        },\n        \"id\": \"busca-pendentes-antigos\",\n        \"name\": \"Busca Lembretes Sem Resposta\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          -1008,\n          1104\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"conditions\": {\n            \"options\": {\n              \"caseSensitive\": true,\n              \"leftValue\": \"\",\n              \"typeValidation\": \"strict\",\n              \"version\": 2\n            },\n            \"conditions\": [\n              {\n                \"id\": \"cond-4h\",\n                \"leftValue\": \"={{ ($now.toMillis() - $json.data_envio.toDateTime().toMillis()) / (1000 * 60 * 60) }}\",\n                \"rightValue\": 4,\n                \"operator\": {\n                  \"type\": \"number\",\n                  \"operation\": \"gte\"\n                }\n              }\n            ],\n            \"combinator\": \"and\"\n          },\n          \"options\": {}\n        },\n        \"id\": \"filtra-4h-sem-resposta\",\n        \"name\": \"Filtra +4h Sem Resposta\",\n        \"type\": \"n8n-nodes-base.filter\",\n        \"typeVersion\": 2.2,\n        \"position\": [\n          -800,\n          1104\n        ]\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"getAll\",\n          \"tableId\": \"agendamentos_completos\",\n          \"limit\": 1,\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"id\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"={{ $json.agendamento_id }}\"\n              }\n            ]\n          }\n        },\n        \"id\": \"busca-evento-escalar\",\n        \"name\": \"Busca Agendamento para Escalar\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          -608,\n          1104\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"assignments\": {\n            \"assignments\": [\n              {\n                \"id\": \"notif-paciente\",\n                \"name\": \"paciente_nome\",\n                \"value\": \"={{ $json.paciente_nome }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"notif-telefone\",\n                \"name\": \"paciente_telefone\",\n                \"value\": \"={{ $json.paciente_telefone || $('Filtra +4h Sem Resposta').item.json.telefone }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"notif-consulta\",\n                \"name\": \"consulta_data\",\n                \"value\": \"={{ $json.data_hora }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"notif-tipo\",\n                \"name\": \"tipo_consulta\",\n                \"value\": \"={{ $json.tipo_consulta }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"notif-profissional\",\n                \"name\": \"profissional\",\n                \"value\": \"={{ $json.profissional }}\",\n                \"type\": \"string\"\n              },\n              {\n                \"id\": \"notif-risco\",\n                \"name\": \"risco_noshow\",\n                \"value\": \"={{ $('Filtra +4h Sem Resposta').item.json.risco_noshow }}\",\n                \"type\": \"number\"\n              },\n              {\n                \"id\": \"notif-lembrete-id\",\n                \"name\": \"lembrete_id\",\n                \"value\": \"={{ $('Filtra +4h Sem Resposta').item.json.id }}\",\n                \"type\": \"number\"\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"prepara-notif-humano\",\n        \"name\": \"Prepara Notificacao Humano\",\n        \"type\": \"n8n-nodes-base.set\",\n        \"typeVersion\": 3.4,\n        \"position\": [\n          -400,\n          1104\n        ]\n      },\n      {\n        \"parameters\": {\n          \"modelId\": {\n            \"__rl\": true,\n            \"value\": \"gpt-4.1-mini\",\n            \"mode\": \"list\"\n          },\n          \"messages\": {\n            \"values\": [\n              {\n                \"content\": \"=Gere um alerta para a recepcionista sobre paciente que nao confirmou consulta.\\n\\nDados:\\n- Paciente: {{ $json.paciente_nome }}\\n- Telefone: {{ $json.paciente_telefone }}\\n- Consulta: {{ $json.consulta_data }}\\n- Risco no-show: {{ $json.risco_noshow * 100 }}%\\n\\nFormato:\\n丘멆잺 PACIENTE NAO CONFIRMOU\\n\\nPaciente: [nome]\\nTelefone: [telefone]\\nConsulta: [data formatada]\\nRisco: [ALTO/MEDIO/BAIXO] ([%])\\n\\nAcao sugerida: [sugestao baseada no risco]\\n\\nRetorne APENAS a mensagem formatada.\"\n              }\n            ]\n          },\n          \"options\": {\n            \"temperature\": 0.3\n          }\n        },\n        \"id\": \"gera-alerta-humano\",\n        \"name\": \"IA Gera Alerta Recepcionista\",\n        \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n        \"typeVersion\": 1.8,\n        \"position\": [\n          -208,\n          1104\n        ],\n        \"credentials\": {\n          \"openAiApi\": {\n            \"id\": \"b2f06NWMfx9VK1I2\",\n            \"name\": \"OpenAi account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"method\": \"POST\",\n          \"url\": \"={{ $('Vari치veis Globais Escalacao').first().json.api_url }}/message/sendText/{{ $('Vari치veis Globais Escalacao').first().json.instancia }}\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"apikey\",\n                \"value\": \"={{ $('Vari치veis Globais Escalacao').first().json.api_key }}\"\n              }\n            ]\n          },\n          \"sendBody\": true,\n          \"specifyBody\": \"json\",\n          \"jsonBody\": \"={\\n    \\\"number\\\": \\\"{{ $json.telefone_recepcionista || '5511999999999' }}\\\",\\n    \\\"text\\\": \\\"{{ $json.alerta.replace(/\\\\n/g, \\\"\\\\\\\\n\\\").replace(/['\\\"]/g, '') }}\\\",\\n    \\\"delay\\\": 2000\\n}\",\n          \"options\": {}\n        },\n        \"id\": \"envia-alerta-recepcionista\",\n        \"name\": \"Envia Alerta Recepcionista\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          64,\n          1104\n        ]\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"update\",\n          \"tableId\": \"lembretes_enviados\",\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"id\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"={{ $('Prepara Notificacao Humano').item.json.lembrete_id }}\"\n              }\n            ]\n          },\n          \"fieldsUi\": {\n            \"fieldValues\": [\n              {\n                \"fieldId\": \"escalado_humano\",\n                \"fieldValue\": \"true\"\n              },\n              {\n                \"fieldId\": \"data_escalacao\",\n                \"fieldValue\": \"={{ $now.toISO() }}\"\n              }\n            ]\n          }\n        },\n        \"id\": \"marca-escalado\",\n        \"name\": \"Marca como Escalado\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          208,\n          1104\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"content\": \"## Escalonamento para Humano\\nVerifica a cada 1h se tem lembrete sem resposta ha mais de 4h\",\n          \"height\": 100,\n          \"width\": 450,\n          \"color\": 7\n        },\n        \"id\": \"sticky-escalacao\",\n        \"name\": \"Sticky Note Escalacao\",\n        \"type\": \"n8n-nodes-base.stickyNote\",\n        \"typeVersion\": 1,\n        \"position\": [\n          -1712,\n          1104\n        ]\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"update\",\n          \"tableId\": \"lembretes_enviados\",\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"id\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"={{ $json.lembrete_id }}\"\n              }\n            ]\n          },\n          \"fieldsUi\": {\n            \"fieldValues\": [\n              {\n                \"fieldId\": \"status_resposta\",\n                \"fieldValue\": \"reagenda\"\n              },\n              {\n                \"fieldId\": \"data_resposta\",\n                \"fieldValue\": \"={{ $now.toISO() }}\"\n              },\n              {\n                \"fieldId\": \"escalado_humano\",\n                \"fieldValue\": \"true\"\n              },\n              {\n                \"fieldId\": \"data_escalacao\",\n                \"fieldValue\": \"={{ $now.toISO() }}\"\n              }\n            ]\n          }\n        },\n        \"id\": \"node-status-reagenda\",\n        \"name\": \"Atualiza Status Reagenda\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          256,\n          720\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"update\",\n          \"tableId\": \"lembretes_enviados\",\n          \"matchType\": \"allFilters\",\n          \"filters\": {\n            \"conditions\": [\n              {\n                \"keyName\": \"id\",\n                \"condition\": \"eq\",\n                \"keyValue\": \"={{ $json.lembrete_id }}\"\n              }\n            ]\n          },\n          \"fieldsUi\": {\n            \"fieldValues\": [\n              {\n                \"fieldId\": \"status_resposta\",\n                \"fieldValue\": \"duvida\"\n              },\n              {\n                \"fieldId\": \"data_resposta\",\n                \"fieldValue\": \"={{ $now.toISO() }}\"\n              },\n              {\n                \"fieldId\": \"escalado_humano\",\n                \"fieldValue\": \"true\"\n              },\n              {\n                \"fieldId\": \"data_escalacao\",\n                \"fieldValue\": \"={{ $now.toISO() }}\"\n              }\n            ]\n          }\n        },\n        \"id\": \"node-status-duvida\",\n        \"name\": \"Atualiza Status Duvida\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          256,\n          880\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"// Busca lembretes j치 enviados via HTTP para Supabase\\nconst items = $input.all();\\n\\n// STEP 1: Deduplica itens na entrada (pega apenas o primeiro de cada combina칞칚o)\\nconst seen = new Set();\\nconst uniqueItems = items.filter(item => {\\n  const key = `${item.json.consulta_id}-${item.json.config_lembrete_nome}`;\\n  if (seen.has(key)) {\\n    return false;\\n  }\\n  seen.add(key);\\n  return true;\\n});\\n\\n// Extrai IDs 칰nicos de agendamentos\\nconst agendamentoIds = [...new Set(uniqueItems.map(i => i.json.consulta_id))];\\n\\nif (agendamentoIds.length === 0) {\\n  return [];\\n}\\n\\n// STEP 2: Busca lembretes j치 enviados no banco\\nconst supabaseUrl = $env.SUPABASE_URL || 'https://gkweofpjwzsvlvnvfbom.supabase.co';\\nconst supabaseKey = $env.SUPABASE_KEY || $env.SUPABASE_ANON_KEY;\\n\\nlet enviados = [];\\ntry {\\n  const response = await fetch(\\n    `${supabaseUrl}/rest/v1/lembretes_enviados?agendamento_id=in.(${agendamentoIds.join(',')})&select=agendamento_id,tipo_lembrete`,\\n    {\\n      headers: {\\n        'apikey': supabaseKey,\\n        'Authorization': `Bearer ${supabaseKey}`\\n      }\\n    }\\n  );\\n  enviados = await response.json();\\n} catch (e) {\\n  console.log('Erro ao buscar lembretes:', e.message);\\n}\\n\\n// STEP 3: Cria set de combina칞칫es j치 enviadas\\nconst jaEnviados = new Set(\\n  enviados.map(e => `${e.agendamento_id}-${e.tipo_lembrete}`)\\n);\\n\\n// STEP 4: Filtra apenas os que N츾O foram enviados\\nconst naoEnviados = uniqueItems.filter(item => {\\n  const chave = `${item.json.consulta_id}-${item.json.config_lembrete_nome}`;\\n  return !jaEnviados.has(chave);\\n});\\n\\nconsole.log(`Items entrada: ${items.length}, 칔nicos: ${uniqueItems.length}, J치 enviados: ${enviados.length}, A enviar: ${naoEnviados.length}`);\\n\\nreturn naoEnviados;\"\n        },\n        \"id\": \"node-filtra-nao-enviados\",\n        \"name\": \"Filtra Nao Enviados\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          0,\n          208\n        ]\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"getAll\",\n          \"tableId\": \"config_evolution\",\n          \"limit\": 1,\n          \"filterType\": \"string\",\n          \"filterString\": \"nome=eq.default\"\n        },\n        \"id\": \"busca-config-evolution\",\n        \"name\": \"Vari치veis Globais\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          -1104,\n          112\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"getAll\",\n          \"tableId\": \"config_evolution\",\n          \"limit\": 1,\n          \"filterType\": \"string\",\n          \"filterString\": \"nome=eq.default\"\n        },\n        \"id\": \"busca-config-evo-webhook\",\n        \"name\": \"Vari치veis Globais Webhook\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          -1104,\n          560\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"getAll\",\n          \"tableId\": \"config_evolution\",\n          \"limit\": 1,\n          \"filterType\": \"string\",\n          \"filterString\": \"nome=eq.default\"\n        },\n        \"id\": \"busca-config-evo-escalacao\",\n        \"name\": \"Vari치veis Globais Escalacao\",\n        \"type\": \"n8n-nodes-base.supabase\",\n        \"typeVersion\": 1,\n        \"position\": [\n          -1104,\n          960\n        ],\n        \"credentials\": {\n          \"supabaseApi\": {\n            \"id\": \"vjxdwL14zFNscRrD\",\n            \"name\": \"Supabase account\"\n          }\n        }\n      }\n    ],\n    \"connections\": {\n      \"Verifica Consultas\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Vari치veis Globais\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Busca Config Lembretes\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Busca Agendamentos 48h\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Busca Agendamentos 48h\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Combina Dados\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Combina Dados\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Calcula Tempo Restante\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Calcula Tempo Restante\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Timing Correto?\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Busca Historico Paciente\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Prepara Dados Analise\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Prepara Dados Analise\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"IA Analisa Risco No-Show\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"IA Analisa Risco No-Show\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Extrai Score Risco\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Extrai Score Risco\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"IA Gera Mensagem\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"IA Gera Mensagem\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Prepara Envio WhatsApp\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Prepara Envio WhatsApp\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Envia WhatsApp\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Envia WhatsApp\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Registra Lembrete Enviado\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Webhook Resposta Paciente\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Vari치veis Globais Webhook\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Extrai Dados Resposta\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Busca Lembrete Pendente\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Busca Lembrete Pendente\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Tem Lembrete Pendente?\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Tem Lembrete Pendente?\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"IA Interpreta Resposta\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"IA Interpreta Resposta\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Extrai Categoria\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Extrai Categoria\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Direciona por Categoria\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Direciona por Categoria\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Atualiza Status Confirmado\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ],\n          [\n            {\n              \"node\": \"Atualiza Status Cancelado\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ],\n          [\n            {\n              \"node\": \"Atualiza Status Reagenda\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ],\n          [\n            {\n              \"node\": \"Atualiza Status Duvida\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Atualiza Status Confirmado\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Responde Paciente\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Atualiza Status Cancelado\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Responde Paciente\",\n              \"type\": \"main\",\n              \"index\": 0\n            },\n            {\n              \"node\": \"Busca Lista Espera\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Busca Lista Espera\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Tem Pessoas na Espera?\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Tem Pessoas na Espera?\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Busca Dados Agendamento\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ],\n          [\n            {\n              \"node\": \"Atualiza Agendamento Cancelado\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Busca Dados Agendamento\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Prepara Oferta Vaga\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Prepara Oferta Vaga\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"IA Gera Mensagem Vaga\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"IA Gera Mensagem Vaga\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Envia Oferta para Espera\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Envia Oferta para Espera\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Atualiza Espera Contatado\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Verifica Nao Respondidos\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Vari치veis Globais Escalacao\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Busca Lembretes Sem Resposta\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Filtra +4h Sem Resposta\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Filtra +4h Sem Resposta\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Busca Agendamento para Escalar\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Busca Agendamento para Escalar\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Prepara Notificacao Humano\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Prepara Notificacao Humano\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"IA Gera Alerta Recepcionista\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"IA Gera Alerta Recepcionista\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Envia Alerta Recepcionista\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Envia Alerta Recepcionista\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Marca como Escalado\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Atualiza Status Reagenda\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Responde Paciente\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Atualiza Status Duvida\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Responde Paciente\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Timing Correto?\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Filtra Nao Enviados\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Filtra Nao Enviados\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Busca Historico Paciente\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Vari치veis Globais\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Busca Config Lembretes\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Vari치veis Globais Webhook\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Extrai Dados Resposta\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Vari치veis Globais Escalacao\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Busca Lembretes Sem Resposta\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      }\n    },\n    \"settings\": {\n      \"executionOrder\": \"v1\",\n      \"callerPolicy\": \"workflowsFromSameOwner\",\n      \"availableInMCP\": false\n    },\n    \"staticData\": {\n      \"node:Verifica Consultas\": {\n        \"recurrenceRules\": []\n      },\n      \"node:Verifica Nao Respondidos\": {\n        \"recurrenceRules\": []\n      }\n    },\n    \"meta\": {\n      \"templateCredsSetupCompleted\": true\n    },\n    \"pinData\": {},\n    \"versionId\": \"1b598bb8-828a-40ee-bf1d-6e006b5f08a1\",\n    \"activeVersionId\": \"1b598bb8-828a-40ee-bf1d-6e006b5f08a1\",\n    \"versionCounter\": 118,\n    \"triggerCount\": 3,\n    \"shared\": [\n      {\n        \"updatedAt\": \"2026-01-12T23:38:36.791Z\",\n        \"createdAt\": \"2026-01-12T23:38:36.791Z\",\n        \"role\": \"workflow:owner\",\n        \"workflowId\": \"HTR3ITfFDrK6eP2R\",\n        \"projectId\": \"ASfue6RWpsJm853c\",\n        \"project\": {\n          \"updatedAt\": \"2025-12-05T22:24:07.951Z\",\n          \"createdAt\": \"2025-12-05T22:00:55.676Z\",\n          \"id\": \"ASfue6RWpsJm853c\",\n          \"name\": \"Gilberto Abrao <ggafbr@gmail.com>\",\n          \"type\": \"personal\",\n          \"icon\": null,\n          \"description\": null,\n          \"projectRelations\": [\n            {\n              \"updatedAt\": \"2025-12-05T22:00:55.677Z\",\n              \"createdAt\": \"2025-12-05T22:00:55.677Z\",\n              \"userId\": \"c33d65c2-d5ef-4f2d-aedf-5c2969300ec6\",\n              \"projectId\": \"ASfue6RWpsJm853c\",\n              \"user\": {\n                \"updatedAt\": \"2026-01-15T12:36:43.000Z\",\n                \"createdAt\": \"2025-12-05T22:00:54.144Z\",\n                \"id\": \"c33d65c2-d5ef-4f2d-aedf-5c2969300ec6\",\n                \"email\": \"ggafbr@gmail.com\",\n                \"firstName\": \"Gilberto\",\n                \"lastName\": \"Abrao\",\n                \"personalizationAnswers\": {\n                  \"version\": \"v4\",\n                  \"personalization_survey_submitted_at\": \"2025-12-05T22:24:49.386Z\",\n                  \"personalization_survey_n8n_version\": \"1.122.5\",\n                  \"companySize\": \"<20\",\n                  \"companyType\": \"saas\",\n                  \"role\": \"business-owner\",\n                  \"reportedSource\": \"youtube\"\n                },\n                \"settings\": {\n                  \"userActivated\": true,\n                  \"easyAIWorkflowOnboarded\": true,\n                  \"firstSuccessfulWorkflowId\": \"bPJamJhBcrVCKgBg\",\n                  \"userActivatedAt\": 1768257177840\n                },\n                \"disabled\": false,\n                \"mfaEnabled\": false,\n                \"lastActiveAt\": \"2026-01-15\",\n                \"isPending\": false\n              }\n            }\n          ]\n        }\n      }\n    ],\n    \"tags\": [],\n    \"activeVersion\": {\n      \"updatedAt\": \"2026-01-14T20:02:00.747Z\",\n      \"createdAt\": \"2026-01-14T20:02:00.747Z\",\n      \"versionId\": \"1b598bb8-828a-40ee-bf1d-6e006b5f08a1\",\n      \"workflowId\": \"HTR3ITfFDrK6eP2R\",\n      \"nodes\": [\n        {\n          \"parameters\": {\n            \"rule\": {\n              \"interval\": [\n                {\n                  \"field\": \"minutes\",\n                  \"minutesInterval\": 15\n                }\n              ]\n            }\n          },\n          \"id\": \"schedule-trigger\",\n          \"name\": \"Verifica Consultas\",\n          \"type\": \"n8n-nodes-base.scheduleTrigger\",\n          \"typeVersion\": 1.2,\n          \"position\": [\n            -1200,\n            304\n          ]\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"getAll\",\n            \"tableId\": \"config_lembretes\",\n            \"returnAll\": true,\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"ativo\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"true\"\n                }\n              ]\n            }\n          },\n          \"id\": \"config-lembretes\",\n          \"name\": \"Busca Config Lembretes\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            -1008,\n            304\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"getAll\",\n            \"tableId\": \"agendamentos_completos\",\n            \"returnAll\": true,\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"data_hora\",\n                  \"condition\": \"gte\",\n                  \"keyValue\": \"={{ $now.toISO() }}\"\n                },\n                {\n                  \"keyName\": \"data_hora\",\n                  \"condition\": \"lte\",\n                  \"keyValue\": \"={{ $now.plus({ hours: 48 }).toISO() }}\"\n                },\n                {\n                  \"keyName\": \"status\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"agendada\"\n                }\n              ]\n            }\n          },\n          \"id\": \"google-calendar\",\n          \"name\": \"Busca Agendamentos 48h\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            -800,\n            304\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {},\n          \"id\": \"merge-data\",\n          \"name\": \"Combina Dados\",\n          \"type\": \"n8n-nodes-base.merge\",\n          \"typeVersion\": 3,\n          \"position\": [\n            -608,\n            304\n          ]\n        },\n        {\n          \"parameters\": {\n            \"assignments\": {\n              \"assignments\": [\n                {\n                  \"id\": \"consulta-id\",\n                  \"name\": \"consulta_id\",\n                  \"value\": \"={{ $json.id }}\",\n                  \"type\": \"number\"\n                },\n                {\n                  \"id\": \"paciente-nome\",\n                  \"name\": \"paciente_nome\",\n                  \"value\": \"={{ $json.paciente_nome }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"paciente-tel\",\n                  \"name\": \"paciente_telefone\",\n                  \"value\": \"={{ $json.paciente_telefone }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"paciente-email\",\n                  \"name\": \"paciente_email\",\n                  \"value\": \"={{ $json.paciente_email || '' }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"evento-inicio\",\n                  \"name\": \"consulta_inicio\",\n                  \"value\": \"={{ $json.data_hora }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"tipo-consulta\",\n                  \"name\": \"tipo_consulta\",\n                  \"value\": \"={{ $json.tipo_consulta }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"profissional\",\n                  \"name\": \"profissional\",\n                  \"value\": \"={{ $json.profissional }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"horas-restantes\",\n                  \"name\": \"horas_ate_consulta\",\n                  \"value\": \"={{ Math.round((new Date($json.data_hora).getTime() - Date.now()) / (1000 * 60 * 60) * 100) / 100 }}\",\n                  \"type\": \"number\"\n                },\n                {\n                  \"id\": \"config-nome\",\n                  \"name\": \"config_lembrete_nome\",\n                  \"value\": \"={{ $json.config_nome || $('Busca Config Lembretes').item.json.nome }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"config-horas\",\n                  \"name\": \"config_horas_antes\",\n                  \"value\": \"={{ $json.config_horas_antes || $('Busca Config Lembretes').item.json.horas_antes }}\",\n                  \"type\": \"number\"\n                },\n                {\n                  \"id\": \"config-template\",\n                  \"name\": \"config_template_tipo\",\n                  \"value\": \"={{ $json.config_template_tipo || $('Busca Config Lembretes').item.json.template_tipo }}\",\n                  \"type\": \"string\"\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"calcula-tempo\",\n          \"name\": \"Calcula Tempo Restante\",\n          \"type\": \"n8n-nodes-base.set\",\n          \"typeVersion\": 3.4,\n          \"position\": [\n            -400,\n            304\n          ]\n        },\n        {\n          \"parameters\": {\n            \"conditions\": {\n              \"options\": {\n                \"version\": 2,\n                \"leftValue\": \"\",\n                \"caseSensitive\": true,\n                \"typeValidation\": \"strict\"\n              },\n              \"conditions\": [\n                {\n                  \"id\": \"cond-timing\",\n                  \"leftValue\": \"={{ $json.horas_ate_consulta }}\",\n                  \"rightValue\": \"={{ $json.config_horas_antes }}\",\n                  \"operator\": {\n                    \"type\": \"number\",\n                    \"operation\": \"lte\"\n                  }\n                },\n                {\n                  \"id\": \"cond-timing-min\",\n                  \"leftValue\": \"={{ $json.horas_ate_consulta }}\",\n                  \"rightValue\": \"={{ $json.config_horas_antes - 2 }}\",\n                  \"operator\": {\n                    \"type\": \"number\",\n                    \"operation\": \"gte\"\n                  }\n                }\n              ],\n              \"combinator\": \"and\"\n            },\n            \"options\": {}\n          },\n          \"id\": \"if-timing\",\n          \"name\": \"Timing Correto?\",\n          \"type\": \"n8n-nodes-base.if\",\n          \"typeVersion\": 2.2,\n          \"position\": [\n            -208,\n            304\n          ]\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"getAll\",\n            \"tableId\": \"historico_noshow\",\n            \"returnAll\": true,\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"telefone\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"={{ $('Calcula Tempo Restante').item.json.paciente_email }}\"\n                }\n              ]\n            }\n          },\n          \"id\": \"busca-historico\",\n          \"name\": \"Busca Historico Paciente\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            400,\n            112\n          ],\n          \"alwaysOutputData\": true,\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"assignments\": {\n              \"assignments\": [\n                {\n                  \"id\": \"dados-paciente\",\n                  \"name\": \"dados_paciente\",\n                  \"value\": \"={{ JSON.stringify($('Calcula Tempo Restante').item.json) }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"historico\",\n                  \"name\": \"historico_noshow\",\n                  \"value\": \"={{ $json.length > 0 ? 'Total consultas: ' + $json.length + ', Faltas: ' + $json.filter(h => !h.compareceu).length : 'Sem historico' }}\",\n                  \"type\": \"string\"\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"prepara-analise\",\n          \"name\": \"Prepara Dados Analise\",\n          \"type\": \"n8n-nodes-base.set\",\n          \"typeVersion\": 3.4,\n          \"position\": [\n            608,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"modelId\": {\n              \"__rl\": true,\n              \"value\": \"gpt-4.1-mini\",\n              \"mode\": \"list\"\n            },\n            \"messages\": {\n              \"values\": [\n                {\n                  \"content\": \"Voce e um analista de risco de no-show para clinica de estetica.\\n\\nAnalise o risco deste paciente faltar na consulta.\\n\\nDados do paciente e consulta:\\n{{ $json.dados_paciente }}\\n\\nHistorico do paciente:\\n{{ $json.historico_noshow }}\\n\\nRegras de analise:\\n- Sexta-feira tarde: +20% risco\\n- Segunda-feira manha: +10% risco\\n- Paciente sem historico: risco medio (0.3)\\n- Cada falta anterior: +15% risco\\n- Consulta de retorno: -10% risco\\n\\nRetorne APENAS um JSON valido (sem markdown):\\n{\\\"risco\\\": 0.0 a 1.0, \\\"fatores\\\": [\\\"fator1\\\", \\\"fator2\\\"], \\\"recomendacao\\\": \\\"lembrete_normal\\\" ou \\\"lembrete_reforcado\\\" ou \\\"ligar_antes\\\"}\"\n                }\n              ]\n            },\n            \"options\": {\n              \"temperature\": 0.3\n            }\n          },\n          \"id\": \"analise-risco\",\n          \"name\": \"IA Analisa Risco No-Show\",\n          \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n          \"typeVersion\": 1.8,\n          \"position\": [\n            784,\n            112\n          ],\n          \"credentials\": {\n            \"openAiApi\": {\n              \"id\": \"b2f06NWMfx9VK1I2\",\n              \"name\": \"OpenAi account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"assignments\": {\n              \"assignments\": [\n                {\n                  \"id\": \"risco-obj\",\n                  \"name\": \"analise_risco\",\n                  \"value\": \"={{ JSON.parse($json.message.content) }}\",\n                  \"type\": \"object\"\n                },\n                {\n                  \"id\": \"risco-score\",\n                  \"name\": \"risco_score\",\n                  \"value\": \"={{ JSON.parse($json.message.content).risco }}\",\n                  \"type\": \"number\"\n                },\n                {\n                  \"id\": \"dados-evento\",\n                  \"name\": \"evento\",\n                  \"value\": \"={{ $('Calcula Tempo Restante').item.json }}\",\n                  \"type\": \"object\"\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"parse-risco\",\n          \"name\": \"Extrai Score Risco\",\n          \"type\": \"n8n-nodes-base.set\",\n          \"typeVersion\": 3.4,\n          \"position\": [\n            1056,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"modelId\": {\n              \"__rl\": true,\n              \"value\": \"gpt-4.1-mini\",\n              \"mode\": \"list\",\n              \"cachedResultName\": \"GPT-4.1-MINI\"\n            },\n            \"messages\": {\n              \"values\": [\n                {\n                  \"content\": \"Voce e Marilia, assistente da Dra. Paula. Gere uma mensagem de lembrete HUMANIZADA para o paciente.\\n\\nDados:\\n- Nome: {{ $json.nome }}\\n- Consulta: {{ $json.tipo_consulta || 'consulta' }}\\n- Data: {{ $json.data_formatada }}\\n- Horario: {{ $json.horario }}\\n- Tipo de lembrete: {{ $json.tipo_lembrete }}\\n\\nREGRAS IMPORTANTES:\\n- NUNCA use frases como 'Responda X ou Y' ou 'Digite CONFIRMAR'\\n- Seja natural e acolhedora como uma secretaria real\\n- Use no maximo 2 emojis\\n- Maximo 3 frases curtas\\n- Se for lembrete_2h, seja mais direta pois a consulta e em breve\\n- Se for lembrete_24h ou 48h, pode ser mais casual\\n\\nExemplos de tom correto:\\n- 'Oi Joao! Passando pra lembrar da sua consulta amanha as 10h com a Dra. Paula. Nos vemos la! 游땕'\\n- 'Gilberto, sua consulta e daqui a pouquinho, as 15h! Qualquer coisa me avisa aqui. Ate ja!'\\n\\nGere apenas a mensagem, sem explicacoes.\"\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"gera-mensagem\",\n          \"name\": \"IA Gera Mensagem\",\n          \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n          \"typeVersion\": 1.8,\n          \"position\": [\n            1200,\n            112\n          ],\n          \"credentials\": {\n            \"openAiApi\": {\n              \"id\": \"b2f06NWMfx9VK1I2\",\n              \"name\": \"OpenAi account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"assignments\": {\n              \"assignments\": [\n                {\n                  \"id\": \"telefone\",\n                  \"name\": \"telefone\",\n                  \"value\": \"={{ $('Calcula Tempo Restante').item.json.paciente_telefone }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"mensagem\",\n                  \"name\": \"mensagem\",\n                  \"value\": \"={{ $json.message.content }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"consulta-id-final\",\n                  \"name\": \"consulta_id\",\n                  \"value\": \"={{ $('Calcula Tempo Restante').item.json.consulta_id }}\",\n                  \"type\": \"number\"\n                },\n                {\n                  \"id\": \"tipo-lembrete\",\n                  \"name\": \"tipo_lembrete\",\n                  \"value\": \"={{ $('Calcula Tempo Restante').item.json.config_lembrete_nome }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"risco-final\",\n                  \"name\": \"risco_score\",\n                  \"value\": \"={{ $('Extrai Score Risco').item.json.risco_score }}\",\n                  \"type\": \"number\"\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"prepara-envio\",\n          \"name\": \"Prepara Envio WhatsApp\",\n          \"type\": \"n8n-nodes-base.set\",\n          \"typeVersion\": 3.4,\n          \"position\": [\n            1472,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"method\": \"POST\",\n            \"url\": \"={{ $('Vari치veis Globais').first().json.api_url }}/message/sendText/{{ $('Vari치veis Globais').first().json.instancia }}\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"apikey\",\n                  \"value\": \"={{ $('Vari치veis Globais').first().json.api_key }}\"\n                }\n              ]\n            },\n            \"sendBody\": true,\n            \"specifyBody\": \"json\",\n            \"jsonBody\": \"={\\n    \\\"number\\\": \\\"{{ $json.telefone }}\\\",\\n    \\\"text\\\": \\\"{{ $json.mensagem.replace(/\\\\n/g, \\\"\\\\\\\\n\\\").replace(/['\\\"]/g, '') }}\\\",\\n    \\\"delay\\\": 2000\\n}\",\n            \"options\": {}\n          },\n          \"id\": \"envia-whatsapp\",\n          \"name\": \"Envia WhatsApp\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            1600,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"tableId\": \"lembretes_enviados\",\n            \"fieldsUi\": {\n              \"fieldValues\": [\n                {\n                  \"fieldId\": \"agendamento_id\",\n                  \"fieldValue\": \"={{ $('Busca Agendamentos 48h').item.json.id }}\"\n                },\n                {\n                  \"fieldId\": \"telefone\",\n                  \"fieldValue\": \"={{ $('Busca Agendamentos 48h').item.json.paciente_telefone }}\"\n                },\n                {\n                  \"fieldId\": \"tipo_lembrete\",\n                  \"fieldValue\": \"={{ $('Busca Config Lembretes').item.json.nome }}\"\n                },\n                {\n                  \"fieldId\": \"mensagem_enviada\",\n                  \"fieldValue\": \"={{ $('IA Gera Mensagem').item.json.message.content }}\"\n                },\n                {\n                  \"fieldId\": \"risco_noshow\",\n                  \"fieldValue\": \"={{ $('Extrai Score Risco').item.json.risco }}\"\n                }\n              ]\n            }\n          },\n          \"id\": \"registra-lembrete\",\n          \"name\": \"Registra Lembrete Enviado\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            1808,\n            112\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"content\": \"## Botfy - Anti No-Show\\nVerifica consultas proximas e envia lembretes inteligentes\",\n            \"height\": 100,\n            \"width\": 400,\n            \"color\": 4\n          },\n          \"id\": \"sticky-titulo\",\n          \"name\": \"Sticky Note\",\n          \"type\": \"n8n-nodes-base.stickyNote\",\n          \"position\": [\n            -1664,\n            304\n          ],\n          \"typeVersion\": 1\n        },\n        {\n          \"parameters\": {\n            \"content\": \"## Analise de Risco IA\\nCalcula probabilidade de no-show\",\n            \"height\": 80,\n            \"width\": 300,\n            \"color\": 2\n          },\n          \"id\": \"sticky-analise\",\n          \"name\": \"Sticky Note1\",\n          \"type\": \"n8n-nodes-base.stickyNote\",\n          \"position\": [\n            752,\n            -48\n          ],\n          \"typeVersion\": 1\n        },\n        {\n          \"parameters\": {\n            \"content\": \"## Envio e Registro\\nWhatsApp + Supabase\",\n            \"height\": 80,\n            \"width\": 300,\n            \"color\": 6\n          },\n          \"id\": \"sticky-envio\",\n          \"name\": \"Sticky Note2\",\n          \"type\": \"n8n-nodes-base.stickyNote\",\n          \"position\": [\n            1360,\n            -48\n          ],\n          \"typeVersion\": 1\n        },\n        {\n          \"parameters\": {\n            \"httpMethod\": \"POST\",\n            \"path\": \"anti-noshow-resposta\",\n            \"options\": {}\n          },\n          \"id\": \"webhook-resposta\",\n          \"name\": \"Webhook Resposta Paciente\",\n          \"type\": \"n8n-nodes-base.webhook\",\n          \"typeVersion\": 2,\n          \"position\": [\n            -1200,\n            704\n          ],\n          \"webhookId\": \"anti-noshow-webhook-001\"\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"// Extrai dados da resposta do Evolution API\\n// Busca dados do webhook diretamente pelo nome do node\\nconst webhookData = $('Webhook Resposta Paciente').first().json;\\nconst body = webhookData.body || {};\\nconst nestedBody = body.body || body;\\n\\n// Busca credenciais das Vari치veis Globais\\nconst config = $input.first().json;\\n\\n// Tenta extrair telefone de diferentes estruturas\\nlet telefone = '';\\nif (nestedBody.data && nestedBody.data.key && nestedBody.data.key.remoteJid) {\\n  telefone = nestedBody.data.key.remoteJid.replace('@s.whatsapp.net', '');\\n}\\n\\n// Tenta extrair mensagem\\nlet mensagem = '';\\nif (nestedBody.data && nestedBody.data.message) {\\n  mensagem = nestedBody.data.message.conversation || \\n             (nestedBody.data.message.extendedTextMessage && nestedBody.data.message.extendedTextMessage.text) || \\n             '';\\n}\\n\\nreturn [{\\n  json: {\\n    telefone,\\n    mensagem,\\n    instancia: config.instancia || nestedBody.instance || '',\\n    api_url: config.api_url || '',\\n    api_key: config.api_key || ''\\n  }\\n}];\"\n          },\n          \"id\": \"extrai-dados-resposta\",\n          \"name\": \"Extrai Dados Resposta\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            -1008,\n            704\n          ]\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"getAll\",\n            \"tableId\": \"lembretes_enviados\",\n            \"limit\": 1,\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"telefone\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"={{ $json.telefone }}\"\n                },\n                {\n                  \"keyName\": \"status_resposta\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"pendente\"\n                }\n              ]\n            }\n          },\n          \"id\": \"busca-lembrete-pendente\",\n          \"name\": \"Busca Lembrete Pendente\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            -800,\n            704\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"conditions\": {\n              \"options\": {\n                \"version\": 2,\n                \"leftValue\": \"\",\n                \"caseSensitive\": true,\n                \"typeValidation\": \"loose\"\n              },\n              \"conditions\": [\n                {\n                  \"id\": \"cond-lembrete\",\n                  \"leftValue\": \"={{ $json.id }}\",\n                  \"rightValue\": \"\",\n                  \"operator\": {\n                    \"type\": \"number\",\n                    \"operation\": \"exists\"\n                  }\n                }\n              ],\n              \"combinator\": \"and\"\n            },\n            \"looseTypeValidation\": true,\n            \"options\": {}\n          },\n          \"id\": \"if-tem-lembrete\",\n          \"name\": \"Tem Lembrete Pendente?\",\n          \"type\": \"n8n-nodes-base.if\",\n          \"typeVersion\": 2.2,\n          \"position\": [\n            -608,\n            704\n          ]\n        },\n        {\n          \"parameters\": {\n            \"modelId\": {\n              \"__rl\": true,\n              \"value\": \"gpt-4.1-mini\",\n              \"mode\": \"list\"\n            },\n            \"messages\": {\n              \"values\": [\n                {\n                  \"content\": \"=Voce e um assistente que interpreta respostas de pacientes sobre confirmacao de consulta.\\n\\nMensagem do paciente: \\\"{{ $('Extrai Dados Resposta').item.json.mensagem }}\\\"\\n\\nClassifique a resposta em UMA das categorias:\\n- CONFIRMA: paciente confirmou presenca (sim, ok, confirmado, vou, estarei la, etc)\\n- CANCELA: paciente quer cancelar (nao vou, cancela, desmarcar, nao posso, etc)\\n- REAGENDA: paciente quer mudar horario (trocar, remarcar, outro horario, etc)\\n- DUVIDA: paciente tem duvida ou resposta nao clara\\n\\nRetorne APENAS um JSON valido:\\n{\\\"categoria\\\": \\\"CONFIRMA|CANCELA|REAGENDA|DUVIDA\\\", \\\"confianca\\\": 0.0 a 1.0, \\\"resposta_sugerida\\\": \\\"mensagem curta para responder ao paciente\\\"}\"\n                }\n              ]\n            },\n            \"options\": {\n              \"temperature\": 0.2\n            }\n          },\n          \"id\": \"ai-interpreta-resposta\",\n          \"name\": \"IA Interpreta Resposta\",\n          \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n          \"typeVersion\": 1.8,\n          \"position\": [\n            -400,\n            608\n          ],\n          \"credentials\": {\n            \"openAiApi\": {\n              \"id\": \"b2f06NWMfx9VK1I2\",\n              \"name\": \"OpenAi account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"assignments\": {\n              \"assignments\": [\n                {\n                  \"id\": \"categoria\",\n                  \"name\": \"categoria\",\n                  \"value\": \"={{ JSON.parse($json.message.content).categoria }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"confianca\",\n                  \"name\": \"confianca\",\n                  \"value\": \"={{ JSON.parse($json.message.content).confianca }}\",\n                  \"type\": \"number\"\n                },\n                {\n                  \"id\": \"resposta-sugerida\",\n                  \"name\": \"resposta_sugerida\",\n                  \"value\": \"={{ JSON.parse($json.message.content).resposta_sugerida }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"lembrete-id\",\n                  \"name\": \"lembrete_id\",\n                  \"value\": \"={{ $('Busca Lembrete Pendente').item.json.id }}\",\n                  \"type\": \"number\"\n                },\n                {\n                  \"id\": \"consulta-id-resp\",\n                  \"name\": \"consulta_id\",\n                  \"value\": \"={{ $('Busca Lembrete Pendente').item.json.consulta_id }}\",\n                  \"type\": \"number\"\n                },\n                {\n                  \"id\": \"telefone-final\",\n                  \"name\": \"telefone\",\n                  \"value\": \"={{ $('Extrai Dados Resposta').item.json.telefone }}\",\n                  \"type\": \"string\"\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"parse-categoria\",\n          \"name\": \"Extrai Categoria\",\n          \"type\": \"n8n-nodes-base.set\",\n          \"typeVersion\": 3.4,\n          \"position\": [\n            -208,\n            608\n          ]\n        },\n        {\n          \"parameters\": {\n            \"rules\": {\n              \"values\": [\n                {\n                  \"conditions\": {\n                    \"options\": {\n                      \"caseSensitive\": true,\n                      \"leftValue\": \"\",\n                      \"typeValidation\": \"strict\",\n                      \"version\": 2\n                    },\n                    \"conditions\": [\n                      {\n                        \"id\": \"cond-confirma\",\n                        \"leftValue\": \"={{ $json.categoria }}\",\n                        \"rightValue\": \"CONFIRMA\",\n                        \"operator\": {\n                          \"type\": \"string\",\n                          \"operation\": \"equals\"\n                        }\n                      }\n                    ],\n                    \"combinator\": \"and\"\n                  },\n                  \"renameOutput\": true,\n                  \"outputKey\": \"CONFIRMA\"\n                },\n                {\n                  \"conditions\": {\n                    \"options\": {\n                      \"caseSensitive\": true,\n                      \"leftValue\": \"\",\n                      \"typeValidation\": \"strict\",\n                      \"version\": 2\n                    },\n                    \"conditions\": [\n                      {\n                        \"id\": \"cond-cancela\",\n                        \"leftValue\": \"={{ $json.categoria }}\",\n                        \"rightValue\": \"CANCELA\",\n                        \"operator\": {\n                          \"type\": \"string\",\n                          \"operation\": \"equals\"\n                        }\n                      }\n                    ],\n                    \"combinator\": \"and\"\n                  },\n                  \"renameOutput\": true,\n                  \"outputKey\": \"CANCELA\"\n                },\n                {\n                  \"conditions\": {\n                    \"options\": {\n                      \"caseSensitive\": true,\n                      \"leftValue\": \"\",\n                      \"typeValidation\": \"strict\",\n                      \"version\": 2\n                    },\n                    \"conditions\": [\n                      {\n                        \"id\": \"cond-reagenda\",\n                        \"leftValue\": \"={{ $json.categoria }}\",\n                        \"rightValue\": \"REAGENDA\",\n                        \"operator\": {\n                          \"type\": \"string\",\n                          \"operation\": \"equals\"\n                        }\n                      }\n                    ],\n                    \"combinator\": \"and\"\n                  },\n                  \"renameOutput\": true,\n                  \"outputKey\": \"REAGENDA\"\n                },\n                {\n                  \"conditions\": {\n                    \"options\": {\n                      \"caseSensitive\": true,\n                      \"leftValue\": \"\",\n                      \"typeValidation\": \"strict\",\n                      \"version\": 2\n                    },\n                    \"conditions\": [\n                      {\n                        \"id\": \"cond-duvida\",\n                        \"leftValue\": \"={{ $json.categoria }}\",\n                        \"rightValue\": \"DUVIDA\",\n                        \"operator\": {\n                          \"type\": \"string\",\n                          \"operation\": \"equals\"\n                        }\n                      }\n                    ],\n                    \"combinator\": \"and\"\n                  },\n                  \"renameOutput\": true,\n                  \"outputKey\": \"DUVIDA\"\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"switch-categoria\",\n          \"name\": \"Direciona por Categoria\",\n          \"type\": \"n8n-nodes-base.switch\",\n          \"typeVersion\": 3.2,\n          \"position\": [\n            0,\n            608\n          ]\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"update\",\n            \"tableId\": \"lembretes_enviados\",\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"id\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"={{ $json.lembrete_id }}\"\n                }\n              ]\n            },\n            \"fieldsUi\": {\n              \"fieldValues\": [\n                {\n                  \"fieldId\": \"status_resposta\",\n                  \"fieldValue\": \"confirmado\"\n                },\n                {\n                  \"fieldId\": \"data_resposta\",\n                  \"fieldValue\": \"={{ $now.toISO() }}\"\n                }\n              ]\n            }\n          },\n          \"id\": \"atualiza-confirmado\",\n          \"name\": \"Atualiza Status Confirmado\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            256,\n            400\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"update\",\n            \"tableId\": \"lembretes_enviados\",\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"id\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"={{ $json.lembrete_id }}\"\n                }\n              ]\n            },\n            \"fieldsUi\": {\n              \"fieldValues\": [\n                {\n                  \"fieldId\": \"status_resposta\",\n                  \"fieldValue\": \"cancelado\"\n                },\n                {\n                  \"fieldId\": \"data_resposta\",\n                  \"fieldValue\": \"={{ $now.toISO() }}\"\n                }\n              ]\n            }\n          },\n          \"id\": \"atualiza-cancelado\",\n          \"name\": \"Atualiza Status Cancelado\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            256,\n            560\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"method\": \"POST\",\n            \"url\": \"={{ $('Vari치veis Globais Webhook').first().json.api_url }}/message/sendText/{{ $('Vari치veis Globais Webhook').first().json.instancia }}\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"apikey\",\n                  \"value\": \"={{ $('Vari치veis Globais Webhook').first().json.api_key }}\"\n                }\n              ]\n            },\n            \"sendBody\": true,\n            \"specifyBody\": \"json\",\n            \"jsonBody\": \"={\\n    \\\"number\\\": \\\"{{ $('Extrai Dados Resposta').first().json.telefone }}\\\",\\n    \\\"text\\\": \\\"{{ ($json.resposta || 'Obrigado pela sua resposta!').replace(/\\\\n/g, \\\"\\\\\\\\n\\\").replace(/['\\\"]/g, '') }}\\\",\\n    \\\"delay\\\": 2000\\n}\",\n            \"options\": {}\n          },\n          \"id\": \"responde-paciente\",\n          \"name\": \"Responde Paciente\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            512,\n            512\n          ]\n        },\n        {\n          \"parameters\": {\n            \"content\": \"## Webhook Respostas\\nRecebe confirmacao/cancelamento do paciente\",\n            \"height\": 100,\n            \"width\": 350,\n            \"color\": 5\n          },\n          \"id\": \"sticky-webhook\",\n          \"name\": \"Sticky Note Webhook\",\n          \"type\": \"n8n-nodes-base.stickyNote\",\n          \"typeVersion\": 1,\n          \"position\": [\n            -1632,\n            704\n          ]\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"getAll\",\n            \"tableId\": \"lista_espera\",\n            \"limit\": 3,\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"status\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"aguardando\"\n                }\n              ]\n            }\n          },\n          \"id\": \"busca-lista-espera\",\n          \"name\": \"Busca Lista Espera\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            256,\n            752\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"conditions\": {\n              \"options\": {\n                \"version\": 2,\n                \"leftValue\": \"\",\n                \"caseSensitive\": true,\n                \"typeValidation\": \"strict\"\n              },\n              \"conditions\": [\n                {\n                  \"id\": \"cond-espera\",\n                  \"leftValue\": \"={{ $json }}\",\n                  \"rightValue\": \"\",\n                  \"operator\": {\n                    \"type\": \"object\",\n                    \"operation\": \"notEmpty\"\n                  }\n                }\n              ],\n              \"combinator\": \"and\"\n            },\n            \"options\": {}\n          },\n          \"id\": \"if-tem-espera\",\n          \"name\": \"Tem Pessoas na Espera?\",\n          \"type\": \"n8n-nodes-base.if\",\n          \"typeVersion\": 2.2,\n          \"position\": [\n            464,\n            752\n          ]\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"getAll\",\n            \"tableId\": \"agendamentos_completos\",\n            \"limit\": 1,\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"id\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"={{ $('Busca Lembrete Pendente').item.json.agendamento_id }}\"\n                }\n              ]\n            }\n          },\n          \"id\": \"busca-evento-cancelado\",\n          \"name\": \"Busca Dados Agendamento\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            656,\n            656\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"assignments\": {\n              \"assignments\": [\n                {\n                  \"id\": \"espera-telefone\",\n                  \"name\": \"telefone_espera\",\n                  \"value\": \"={{ $('Busca Lista Espera').item.json.telefone }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"espera-nome\",\n                  \"name\": \"nome_espera\",\n                  \"value\": \"={{ $('Busca Lista Espera').item.json.nome }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"espera-id\",\n                  \"name\": \"espera_id\",\n                  \"value\": \"={{ $('Busca Lista Espera').item.json.id }}\",\n                  \"type\": \"number\"\n                },\n                {\n                  \"id\": \"consulta-data\",\n                  \"name\": \"evento_data\",\n                  \"value\": \"={{ $json.data_hora }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"consulta-tipo\",\n                  \"name\": \"evento_titulo\",\n                  \"value\": \"={{ $json.tipo_consulta }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"consulta-id\",\n                  \"name\": \"consulta_id\",\n                  \"value\": \"={{ $json.id }}\",\n                  \"type\": \"number\"\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"prepara-oferta-vaga\",\n          \"name\": \"Prepara Oferta Vaga\",\n          \"type\": \"n8n-nodes-base.set\",\n          \"typeVersion\": 3.4,\n          \"position\": [\n            864,\n            656\n          ]\n        },\n        {\n          \"parameters\": {\n            \"modelId\": {\n              \"__rl\": true,\n              \"value\": \"gpt-4.1-mini\",\n              \"mode\": \"list\"\n            },\n            \"messages\": {\n              \"values\": [\n                {\n                  \"content\": \"=Gere uma mensagem curta oferecendo uma vaga que abriu para um paciente na lista de espera.\\n\\nDados:\\n- Nome do paciente: {{ $json.nome_espera }}\\n- Data/hora da vaga: {{ $json.evento_data }}\\n- Clinica da Dra. Paula\\n\\nRegras:\\n- Maximo 200 caracteres\\n- Tom animado mas profissional\\n- Pedir para responder SIM se quiser a vaga\\n- Mencionar que e por ordem de chegada\\n- Assinar como Marilia\\n\\nRetorne APENAS a mensagem, sem aspas.\"\n                }\n              ]\n            },\n            \"options\": {\n              \"temperature\": 0.7\n            }\n          },\n          \"id\": \"gera-msg-espera\",\n          \"name\": \"IA Gera Mensagem Vaga\",\n          \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n          \"typeVersion\": 1.8,\n          \"position\": [\n            1056,\n            656\n          ],\n          \"credentials\": {\n            \"openAiApi\": {\n              \"id\": \"b2f06NWMfx9VK1I2\",\n              \"name\": \"OpenAi account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"method\": \"POST\",\n            \"url\": \"={{ $('Vari치veis Globais Webhook').first().json.api_url }}/message/sendText/{{ $('Vari치veis Globais Webhook').first().json.instancia }}\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"apikey\",\n                  \"value\": \"={{ $('Vari치veis Globais Webhook').first().json.api_key }}\"\n                }\n              ]\n            },\n            \"sendBody\": true,\n            \"specifyBody\": \"json\",\n            \"jsonBody\": \"={\\n    \\\"number\\\": \\\"{{ $json.telefone }}\\\",\\n    \\\"text\\\": \\\"{{ $json.mensagem.replace(/\\\\n/g, \\\"\\\\\\\\n\\\").replace(/['\\\"]/g, '') }}\\\",\\n    \\\"delay\\\": 2000\\n}\",\n            \"options\": {}\n          },\n          \"id\": \"envia-oferta-espera\",\n          \"name\": \"Envia Oferta para Espera\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            1344,\n            656\n          ]\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"update\",\n            \"tableId\": \"lista_espera\",\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"id\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"={{ $('Prepara Oferta Vaga').item.json.espera_id }}\"\n                }\n              ]\n            },\n            \"fieldsUi\": {\n              \"fieldValues\": [\n                {\n                  \"fieldId\": \"status\",\n                  \"fieldValue\": \"contatado\"\n                },\n                {\n                  \"fieldId\": \"data_contato\",\n                  \"fieldValue\": \"={{ $now.toISO() }}\"\n                }\n              ]\n            }\n          },\n          \"id\": \"atualiza-espera-contatado\",\n          \"name\": \"Atualiza Espera Contatado\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            1504,\n            656\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"update\",\n            \"tableId\": \"agendamentos\",\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"id\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"={{ $('Busca Lembrete Pendente').item.json.agendamento_id }}\"\n                }\n              ]\n            },\n            \"fieldsUi\": {\n              \"fieldValues\": [\n                {\n                  \"fieldId\": \"status\",\n                  \"fieldValue\": \"cancelada\"\n                },\n                {\n                  \"fieldId\": \"updated_at\",\n                  \"fieldValue\": \"={{ $now.toISO() }}\"\n                }\n              ]\n            }\n          },\n          \"id\": \"deleta-evento-calendar\",\n          \"name\": \"Atualiza Agendamento Cancelado\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            464,\n            912\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"content\": \"## Lista de Espera\\nQuando cancela, oferece vaga para quem esta aguardando\",\n            \"height\": 80,\n            \"width\": 448,\n            \"color\": 3\n          },\n          \"id\": \"sticky-lista-espera\",\n          \"name\": \"Sticky Note Lista Espera\",\n          \"type\": \"n8n-nodes-base.stickyNote\",\n          \"typeVersion\": 1,\n          \"position\": [\n            528,\n            400\n          ]\n        },\n        {\n          \"parameters\": {\n            \"rule\": {\n              \"interval\": [\n                {\n                  \"field\": \"hours\"\n                }\n              ]\n            }\n          },\n          \"id\": \"schedule-escalacao\",\n          \"name\": \"Verifica Nao Respondidos\",\n          \"type\": \"n8n-nodes-base.scheduleTrigger\",\n          \"typeVersion\": 1.2,\n          \"position\": [\n            -1200,\n            1104\n          ]\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"getAll\",\n            \"tableId\": \"lembretes_enviados\",\n            \"returnAll\": true,\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"status_resposta\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"pendente\"\n                },\n                {\n                  \"keyName\": \"escalado_humano\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"false\"\n                }\n              ]\n            }\n          },\n          \"id\": \"busca-pendentes-antigos\",\n          \"name\": \"Busca Lembretes Sem Resposta\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            -1008,\n            1104\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"conditions\": {\n              \"options\": {\n                \"caseSensitive\": true,\n                \"leftValue\": \"\",\n                \"typeValidation\": \"strict\",\n                \"version\": 2\n              },\n              \"conditions\": [\n                {\n                  \"id\": \"cond-4h\",\n                  \"leftValue\": \"={{ ($now.toMillis() - $json.data_envio.toDateTime().toMillis()) / (1000 * 60 * 60) }}\",\n                  \"rightValue\": 4,\n                  \"operator\": {\n                    \"type\": \"number\",\n                    \"operation\": \"gte\"\n                  }\n                }\n              ],\n              \"combinator\": \"and\"\n            },\n            \"options\": {}\n          },\n          \"id\": \"filtra-4h-sem-resposta\",\n          \"name\": \"Filtra +4h Sem Resposta\",\n          \"type\": \"n8n-nodes-base.filter\",\n          \"typeVersion\": 2.2,\n          \"position\": [\n            -800,\n            1104\n          ]\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"getAll\",\n            \"tableId\": \"agendamentos_completos\",\n            \"limit\": 1,\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"id\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"={{ $json.agendamento_id }}\"\n                }\n              ]\n            }\n          },\n          \"id\": \"busca-evento-escalar\",\n          \"name\": \"Busca Agendamento para Escalar\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            -608,\n            1104\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"assignments\": {\n              \"assignments\": [\n                {\n                  \"id\": \"notif-paciente\",\n                  \"name\": \"paciente_nome\",\n                  \"value\": \"={{ $json.paciente_nome }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"notif-telefone\",\n                  \"name\": \"paciente_telefone\",\n                  \"value\": \"={{ $json.paciente_telefone || $('Filtra +4h Sem Resposta').item.json.telefone }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"notif-consulta\",\n                  \"name\": \"consulta_data\",\n                  \"value\": \"={{ $json.data_hora }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"notif-tipo\",\n                  \"name\": \"tipo_consulta\",\n                  \"value\": \"={{ $json.tipo_consulta }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"notif-profissional\",\n                  \"name\": \"profissional\",\n                  \"value\": \"={{ $json.profissional }}\",\n                  \"type\": \"string\"\n                },\n                {\n                  \"id\": \"notif-risco\",\n                  \"name\": \"risco_noshow\",\n                  \"value\": \"={{ $('Filtra +4h Sem Resposta').item.json.risco_noshow }}\",\n                  \"type\": \"number\"\n                },\n                {\n                  \"id\": \"notif-lembrete-id\",\n                  \"name\": \"lembrete_id\",\n                  \"value\": \"={{ $('Filtra +4h Sem Resposta').item.json.id }}\",\n                  \"type\": \"number\"\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"prepara-notif-humano\",\n          \"name\": \"Prepara Notificacao Humano\",\n          \"type\": \"n8n-nodes-base.set\",\n          \"typeVersion\": 3.4,\n          \"position\": [\n            -400,\n            1104\n          ]\n        },\n        {\n          \"parameters\": {\n            \"modelId\": {\n              \"__rl\": true,\n              \"value\": \"gpt-4.1-mini\",\n              \"mode\": \"list\"\n            },\n            \"messages\": {\n              \"values\": [\n                {\n                  \"content\": \"=Gere um alerta para a recepcionista sobre paciente que nao confirmou consulta.\\n\\nDados:\\n- Paciente: {{ $json.paciente_nome }}\\n- Telefone: {{ $json.paciente_telefone }}\\n- Consulta: {{ $json.consulta_data }}\\n- Risco no-show: {{ $json.risco_noshow * 100 }}%\\n\\nFormato:\\n丘멆잺 PACIENTE NAO CONFIRMOU\\n\\nPaciente: [nome]\\nTelefone: [telefone]\\nConsulta: [data formatada]\\nRisco: [ALTO/MEDIO/BAIXO] ([%])\\n\\nAcao sugerida: [sugestao baseada no risco]\\n\\nRetorne APENAS a mensagem formatada.\"\n                }\n              ]\n            },\n            \"options\": {\n              \"temperature\": 0.3\n            }\n          },\n          \"id\": \"gera-alerta-humano\",\n          \"name\": \"IA Gera Alerta Recepcionista\",\n          \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n          \"typeVersion\": 1.8,\n          \"position\": [\n            -208,\n            1104\n          ],\n          \"credentials\": {\n            \"openAiApi\": {\n              \"id\": \"b2f06NWMfx9VK1I2\",\n              \"name\": \"OpenAi account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"method\": \"POST\",\n            \"url\": \"={{ $('Vari치veis Globais Escalacao').first().json.api_url }}/message/sendText/{{ $('Vari치veis Globais Escalacao').first().json.instancia }}\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"apikey\",\n                  \"value\": \"={{ $('Vari치veis Globais Escalacao').first().json.api_key }}\"\n                }\n              ]\n            },\n            \"sendBody\": true,\n            \"specifyBody\": \"json\",\n            \"jsonBody\": \"={\\n    \\\"number\\\": \\\"{{ $json.telefone_recepcionista || '5511999999999' }}\\\",\\n    \\\"text\\\": \\\"{{ $json.alerta.replace(/\\\\n/g, \\\"\\\\\\\\n\\\").replace(/['\\\"]/g, '') }}\\\",\\n    \\\"delay\\\": 2000\\n}\",\n            \"options\": {}\n          },\n          \"id\": \"envia-alerta-recepcionista\",\n          \"name\": \"Envia Alerta Recepcionista\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            64,\n            1104\n          ]\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"update\",\n            \"tableId\": \"lembretes_enviados\",\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"id\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"={{ $('Prepara Notificacao Humano').item.json.lembrete_id }}\"\n                }\n              ]\n            },\n            \"fieldsUi\": {\n              \"fieldValues\": [\n                {\n                  \"fieldId\": \"escalado_humano\",\n                  \"fieldValue\": \"true\"\n                },\n                {\n                  \"fieldId\": \"data_escalacao\",\n                  \"fieldValue\": \"={{ $now.toISO() }}\"\n                }\n              ]\n            }\n          },\n          \"id\": \"marca-escalado\",\n          \"name\": \"Marca como Escalado\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            208,\n            1104\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"content\": \"## Escalonamento para Humano\\nVerifica a cada 1h se tem lembrete sem resposta ha mais de 4h\",\n            \"height\": 100,\n            \"width\": 450,\n            \"color\": 7\n          },\n          \"id\": \"sticky-escalacao\",\n          \"name\": \"Sticky Note Escalacao\",\n          \"type\": \"n8n-nodes-base.stickyNote\",\n          \"typeVersion\": 1,\n          \"position\": [\n            -1712,\n            1104\n          ]\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"update\",\n            \"tableId\": \"lembretes_enviados\",\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"id\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"={{ $json.lembrete_id }}\"\n                }\n              ]\n            },\n            \"fieldsUi\": {\n              \"fieldValues\": [\n                {\n                  \"fieldId\": \"status_resposta\",\n                  \"fieldValue\": \"reagenda\"\n                },\n                {\n                  \"fieldId\": \"data_resposta\",\n                  \"fieldValue\": \"={{ $now.toISO() }}\"\n                },\n                {\n                  \"fieldId\": \"escalado_humano\",\n                  \"fieldValue\": \"true\"\n                },\n                {\n                  \"fieldId\": \"data_escalacao\",\n                  \"fieldValue\": \"={{ $now.toISO() }}\"\n                }\n              ]\n            }\n          },\n          \"id\": \"node-status-reagenda\",\n          \"name\": \"Atualiza Status Reagenda\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            256,\n            720\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"update\",\n            \"tableId\": \"lembretes_enviados\",\n            \"matchType\": \"allFilters\",\n            \"filters\": {\n              \"conditions\": [\n                {\n                  \"keyName\": \"id\",\n                  \"condition\": \"eq\",\n                  \"keyValue\": \"={{ $json.lembrete_id }}\"\n                }\n              ]\n            },\n            \"fieldsUi\": {\n              \"fieldValues\": [\n                {\n                  \"fieldId\": \"status_resposta\",\n                  \"fieldValue\": \"duvida\"\n                },\n                {\n                  \"fieldId\": \"data_resposta\",\n                  \"fieldValue\": \"={{ $now.toISO() }}\"\n                },\n                {\n                  \"fieldId\": \"escalado_humano\",\n                  \"fieldValue\": \"true\"\n                },\n                {\n                  \"fieldId\": \"data_escalacao\",\n                  \"fieldValue\": \"={{ $now.toISO() }}\"\n                }\n              ]\n            }\n          },\n          \"id\": \"node-status-duvida\",\n          \"name\": \"Atualiza Status Duvida\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            256,\n            880\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"// Busca lembretes j치 enviados via HTTP para Supabase\\nconst items = $input.all();\\n\\n// STEP 1: Deduplica itens na entrada (pega apenas o primeiro de cada combina칞칚o)\\nconst seen = new Set();\\nconst uniqueItems = items.filter(item => {\\n  const key = `${item.json.consulta_id}-${item.json.config_lembrete_nome}`;\\n  if (seen.has(key)) {\\n    return false;\\n  }\\n  seen.add(key);\\n  return true;\\n});\\n\\n// Extrai IDs 칰nicos de agendamentos\\nconst agendamentoIds = [...new Set(uniqueItems.map(i => i.json.consulta_id))];\\n\\nif (agendamentoIds.length === 0) {\\n  return [];\\n}\\n\\n// STEP 2: Busca lembretes j치 enviados no banco\\nconst supabaseUrl = $env.SUPABASE_URL || 'https://gkweofpjwzsvlvnvfbom.supabase.co';\\nconst supabaseKey = $env.SUPABASE_KEY || $env.SUPABASE_ANON_KEY;\\n\\nlet enviados = [];\\ntry {\\n  const response = await fetch(\\n    `${supabaseUrl}/rest/v1/lembretes_enviados?agendamento_id=in.(${agendamentoIds.join(',')})&select=agendamento_id,tipo_lembrete`,\\n    {\\n      headers: {\\n        'apikey': supabaseKey,\\n        'Authorization': `Bearer ${supabaseKey}`\\n      }\\n    }\\n  );\\n  enviados = await response.json();\\n} catch (e) {\\n  console.log('Erro ao buscar lembretes:', e.message);\\n}\\n\\n// STEP 3: Cria set de combina칞칫es j치 enviadas\\nconst jaEnviados = new Set(\\n  enviados.map(e => `${e.agendamento_id}-${e.tipo_lembrete}`)\\n);\\n\\n// STEP 4: Filtra apenas os que N츾O foram enviados\\nconst naoEnviados = uniqueItems.filter(item => {\\n  const chave = `${item.json.consulta_id}-${item.json.config_lembrete_nome}`;\\n  return !jaEnviados.has(chave);\\n});\\n\\nconsole.log(`Items entrada: ${items.length}, 칔nicos: ${uniqueItems.length}, J치 enviados: ${enviados.length}, A enviar: ${naoEnviados.length}`);\\n\\nreturn naoEnviados;\"\n          },\n          \"id\": \"node-filtra-nao-enviados\",\n          \"name\": \"Filtra Nao Enviados\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            0,\n            208\n          ]\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"getAll\",\n            \"tableId\": \"config_evolution\",\n            \"limit\": 1,\n            \"filterType\": \"string\",\n            \"filterString\": \"nome=eq.default\"\n          },\n          \"id\": \"busca-config-evolution\",\n          \"name\": \"Vari치veis Globais\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            -1104,\n            112\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"getAll\",\n            \"tableId\": \"config_evolution\",\n            \"limit\": 1,\n            \"filterType\": \"string\",\n            \"filterString\": \"nome=eq.default\"\n          },\n          \"id\": \"busca-config-evo-webhook\",\n          \"name\": \"Vari치veis Globais Webhook\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            -1104,\n            560\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"getAll\",\n            \"tableId\": \"config_evolution\",\n            \"limit\": 1,\n            \"filterType\": \"string\",\n            \"filterString\": \"nome=eq.default\"\n          },\n          \"id\": \"busca-config-evo-escalacao\",\n          \"name\": \"Vari치veis Globais Escalacao\",\n          \"type\": \"n8n-nodes-base.supabase\",\n          \"typeVersion\": 1,\n          \"position\": [\n            -1104,\n            960\n          ],\n          \"credentials\": {\n            \"supabaseApi\": {\n              \"id\": \"vjxdwL14zFNscRrD\",\n              \"name\": \"Supabase account\"\n            }\n          }\n        }\n      ],\n      \"connections\": {\n        \"Verifica Consultas\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Vari치veis Globais\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Busca Config Lembretes\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Busca Agendamentos 48h\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Busca Agendamentos 48h\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Combina Dados\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Combina Dados\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Calcula Tempo Restante\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Calcula Tempo Restante\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Timing Correto?\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Busca Historico Paciente\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Prepara Dados Analise\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Prepara Dados Analise\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"IA Analisa Risco No-Show\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"IA Analisa Risco No-Show\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Extrai Score Risco\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Extrai Score Risco\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"IA Gera Mensagem\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"IA Gera Mensagem\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Prepara Envio WhatsApp\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Prepara Envio WhatsApp\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Envia WhatsApp\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Envia WhatsApp\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Registra Lembrete Enviado\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Webhook Resposta Paciente\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Vari치veis Globais Webhook\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Extrai Dados Resposta\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Busca Lembrete Pendente\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Busca Lembrete Pendente\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Tem Lembrete Pendente?\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Tem Lembrete Pendente?\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"IA Interpreta Resposta\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"IA Interpreta Resposta\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Extrai Categoria\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Extrai Categoria\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Direciona por Categoria\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Direciona por Categoria\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Atualiza Status Confirmado\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ],\n            [\n              {\n                \"node\": \"Atualiza Status Cancelado\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ],\n            [\n              {\n                \"node\": \"Atualiza Status Reagenda\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ],\n            [\n              {\n                \"node\": \"Atualiza Status Duvida\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Atualiza Status Confirmado\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Responde Paciente\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Atualiza Status Cancelado\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Responde Paciente\",\n                \"type\": \"main\",\n                \"index\": 0\n              },\n              {\n                \"node\": \"Busca Lista Espera\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Busca Lista Espera\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Tem Pessoas na Espera?\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Tem Pessoas na Espera?\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Busca Dados Agendamento\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ],\n            [\n              {\n                \"node\": \"Atualiza Agendamento Cancelado\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Busca Dados Agendamento\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Prepara Oferta Vaga\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Prepara Oferta Vaga\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"IA Gera Mensagem Vaga\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"IA Gera Mensagem Vaga\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Envia Oferta para Espera\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Envia Oferta para Espera\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Atualiza Espera Contatado\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Verifica Nao Respondidos\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Vari치veis Globais Escalacao\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Busca Lembretes Sem Resposta\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Filtra +4h Sem Resposta\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Filtra +4h Sem Resposta\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Busca Agendamento para Escalar\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Busca Agendamento para Escalar\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Prepara Notificacao Humano\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Prepara Notificacao Humano\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"IA Gera Alerta Recepcionista\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"IA Gera Alerta Recepcionista\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Envia Alerta Recepcionista\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Envia Alerta Recepcionista\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Marca como Escalado\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Atualiza Status Reagenda\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Responde Paciente\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Atualiza Status Duvida\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Responde Paciente\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Timing Correto?\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Filtra Nao Enviados\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Filtra Nao Enviados\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Busca Historico Paciente\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Vari치veis Globais\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Busca Config Lembretes\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Vari치veis Globais Webhook\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Extrai Dados Resposta\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Vari치veis Globais Escalacao\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Busca Lembretes Sem Resposta\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        }\n      },\n      \"authors\": \"Gilberto Abrao\",\n      \"name\": null,\n      \"description\": null\n    }\n  }\n}"
  }
]