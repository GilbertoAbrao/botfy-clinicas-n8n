---
plan_id: 02-02
phase: 2
wave: 2
title: Alert List UI & Filtering
status: not_started
dependencies: [02-01]
must_haves:
  truths:
    - Alert list shows all alerts with priority indicators
    - Filters work: type, status, date range
    - Sort works: priority, date, patient, status
    - Mobile-responsive layout (works on phones/tablets)
    - Touch-friendly UI (large tap targets, swipe gestures)
    - Loading states and empty states handled
  artifacts:
    - src/app/dashboard/alerts/page.tsx (alert list page)
    - src/components/alerts/alert-list.tsx (alert list component)
    - src/components/alerts/alert-filters.tsx (filter component)
    - src/lib/api/alerts.ts (alert API functions)
  key_links:
    - Alert list page: src/app/dashboard/alerts/page.tsx
    - shadcn/ui Table: https://ui.shadcn.com/docs/components/table
    - shadcn/ui Select: https://ui.shadcn.com/docs/components/select
---

# Plan 02-02: Alert List UI & Filtering

## Objective

Build alert queue interface with filtering (type, status, date range), sorting (priority, date, patient, status), and mobile-responsive design. Enable users to view and navigate all alerts requiring attention.

## Execution Context

**Prerequisites:**
- Plan 02-01 complete (database schema, seed data)
- shadcn/ui components installed (Table, Select, Button, Badge, Input)
- Dashboard layout from Phase 1

**Key Files:**
- src/app/dashboard/page.tsx (current dashboard)
- src/lib/supabase/server.ts (Supabase server client)
- src/lib/auth/rbac.ts (permission system)

**External Resources:**
- shadcn/ui Table: https://ui.shadcn.com/docs/components/table
- shadcn/ui Select: https://ui.shadcn.com/docs/components/select
- shadcn/ui Date Picker: https://ui.shadcn.com/docs/components/date-picker

## Context

This plan delivers the core alert queue - the primary interface for Botfy ClinicOps. Staff need to see "at glance" what requires attention, filter by urgency/type, and sort by priority. Mobile-first design is critical as atendentes use phones/tablets.

**UX Goals:**
- Urgent alerts visually distinct (red badge, top of list)
- Quick filter access (type, status without page navigation)
- Sort persistence (remembers user preference)
- Touch-friendly (44px minimum tap targets)
- Fast loading (<500ms for alert list)

**Requirements Covered:**
- ALERT-01: View real-time alert queue
- ALERT-02: Priority/urgency indicators
- ALERT-03: Filter by type
- ALERT-04: Filter by status
- ALERT-05: Filter by date range
- ALERT-06: Sort by priority, date, patient, status
- UX-01: Mobile-responsive
- UX-02: Touch-friendly

## Tasks

### Task 1: Create alert API layer
- [ ] Create src/lib/api/alerts.ts with server functions:
  - `fetchAlerts()`: Get all alerts with optional filters
    - Parameters: { type?, status?, dateFrom?, dateTo?, sortBy?, sortOrder? }
    - Return: Alert[] with patient/appointment/conversation relations
    - Use Prisma include to eager-load relations
    - Apply filters with Prisma where clause
    - Apply sorting with Prisma orderBy
    - Limit to 100 alerts (pagination later)
  - `getAlertById(id)`: Get single alert with full context
  - `updateAlertStatus(id, status)`: Update alert status (new/in-progress/resolved/dismissed)
    - Set resolvedAt if status is resolved/dismissed
    - Set resolvedBy to current user ID
    - Log audit trail with logAudit()
- [ ] Add TypeScript types:
  - `AlertWithRelations` type (Alert + patient + appointment + conversation)
  - `AlertFilters` type (filter parameters)
  - `AlertSortBy` type ('priority' | 'date' | 'patient' | 'status')
- [ ] Add error handling with try-catch and getUserFriendlyMessage()
- [ ] Test API functions with seed data

### Task 2: Install missing shadcn/ui components
- [ ] Check existing components: `ls src/components/ui/`
- [ ] Install Table: `npx shadcn@latest add table`
- [ ] Install Select: `npx shadcn@latest add select`
- [ ] Install Badge: `npx shadcn@latest add badge`
- [ ] Install Popover: `npx shadcn@latest add popover` (for date picker)
- [ ] Install Calendar: `npx shadcn@latest add calendar` (for date range filter)
- [ ] Verify components build successfully

### Task 3: Create alert list component
- [ ] Create src/components/alerts/alert-list.tsx
- [ ] Build AlertList component structure:
  - Accept props: alerts (AlertWithRelations[]), loading (boolean)
  - Use shadcn/ui Table for desktop layout
  - Columns: Priority, Type, Patient, Status, Created, Actions
  - Priority column: Badge with color coding (urgent=red, high=orange, low=gray)
  - Type column: Readable labels (conversas_travadas → "Conversa Travada")
  - Patient column: Patient name or "—" if no patient linked
  - Status column: Badge with color (new=blue, in-progress=yellow, resolved=green, dismissed=gray)
  - Created column: Relative time (e.g., "2 hours ago" using date-fns)
  - Actions column: "Ver Detalhes" button (navigate to detail page - Plan 02-03)
- [ ] Add mobile card layout (hidden on desktop, shown on mobile):
  - Each alert as card with priority badge at top
  - Patient name and alert type as header
  - Status and created time as footer
  - Tap card to navigate to detail view
  - Large tap targets (min 44px height)
- [ ] Add loading state: Skeleton rows while data fetches
- [ ] Add empty state: "Nenhum alerta encontrado" with illustration/icon
- [ ] Add hover effects for desktop (row highlight)
- [ ] Add touch feedback for mobile (active state on tap)
- [ ] Use Botfy brand colors for badges and highlights

### Task 4: Create filter component
- [ ] Create src/components/alerts/alert-filters.tsx
- [ ] Build AlertFilters component:
  - Accept props: onFilterChange (callback with filter values)
  - Type filter: Select dropdown with options (all, conversas_travadas, pre_checkins_pendentes, agendamentos_nao_confirmados, handoff_normal, handoff_erro)
  - Status filter: Select dropdown with options (all, new, in_progress, resolved, dismissed)
  - Date range filter: Two date pickers (from, to) with Popover + Calendar
  - Sort dropdown: Select with options (priority, date, patient, status)
  - Sort order toggle: Button with arrow icon (asc/desc)
  - "Limpar Filtros" button to reset all filters
- [ ] Implement filter logic:
  - On filter change, call onFilterChange with updated values
  - Debounce filter changes (500ms) to avoid excessive queries
  - Store filter state in URL query params (persistence across page refresh)
- [ ] Mobile layout:
  - Collapsible filter panel (hidden by default on mobile)
  - "Filtros" button to toggle filter panel
  - Filters stack vertically on mobile
  - Full-width dropdowns for touch usability
- [ ] Add filter count badge (e.g., "Filtros (3)" when 3 filters active)
- [ ] Style with Botfy brand colors

### Task 5: Create alert list page
- [ ] Create src/app/dashboard/alerts/page.tsx
- [ ] Implement page logic:
  - Fetch alerts on page load using fetchAlerts()
  - Parse URL query params for initial filters (type, status, dateFrom, dateTo, sortBy, sortOrder)
  - Pass alerts to AlertList component
  - Pass filter callback to AlertFilters component
  - On filter change: Update URL query params, refetch alerts
  - Handle loading state (show skeleton)
  - Handle error state (show error message with retry button)
- [ ] Add page header:
  - Title: "Alertas" with count badge (e.g., "Alertas (5 novos)")
  - Subtitle: Brief description "Todos os problemas que precisam de atenção"
- [ ] Add layout structure:
  - Top: Page header
  - Below header: AlertFilters component (sticky on scroll for desktop)
  - Main area: AlertList component
  - Bottom: Pagination placeholder (implement in future if needed)
- [ ] Add RBAC check: Require 'view_alerts' permission (all authenticated users)
- [ ] Add audit logging: Log VIEW_ALERTS action on page load
- [ ] Test with seed data: Verify all 8 test alerts display correctly
- [ ] Test filters: Apply type filter, verify only matching alerts show
- [ ] Test sorting: Sort by priority, verify urgent alerts at top
- [ ] Test mobile: Verify card layout on small screens

### Task 6: Update dashboard navigation
- [ ] Edit src/app/dashboard/page.tsx
- [ ] Add "Alertas" link to dashboard header navigation (between logo and user menu)
- [ ] Use Link component from next/link
- [ ] Highlight active link when on /dashboard/alerts
- [ ] Add alert count badge to navigation link (fetch unresolved count)
- [ ] Test navigation: Click "Alertas" link, verify navigation to /dashboard/alerts

## Verification

**Must Pass:**
1. Navigate to /dashboard/alerts - page loads without errors
2. Alert list shows all 8 seed alerts with correct priority badges
3. Filter by "conversas_travadas" - only 2 matching alerts show
4. Filter by status "new" - only 6 new alerts show (2 resolved/dismissed hidden)
5. Sort by priority - urgent alerts at top, then high, then low
6. Date range filter works - select yesterday to today, see relevant alerts
7. Mobile responsive: Resize to 375px width, see card layout (not table)
8. Touch tap on mobile alert card - navigates to detail page (Plan 02-03 placeholder)
9. Loading state shows skeleton while data fetches
10. Empty state shows when no alerts match filters
11. Build passes: `npm run build`

**Quality Checks:**
- Tap targets ≥44px height on mobile
- No horizontal scroll on mobile (max-width: 100vw)
- Filter changes update URL query params (shareable links)
- Filter state persists across page refresh
- Brand colors used consistently (Botfy primary, secondary)

## Success Criteria

- [x] Alert list page created at /dashboard/alerts
- [x] Alert list shows all alerts with priority/status badges
- [x] Filters work: type, status, date range
- [x] Sort works: priority, date, patient, status
- [x] Mobile-responsive layout (card view on phones)
- [x] Touch-friendly UI (44px tap targets)
- [x] Loading and empty states implemented
- [x] Navigation link added to dashboard header
- [x] Build passes: `npm run build`

## Output

**Deliverables:**
1. Alert API functions: src/lib/api/alerts.ts
2. Alert list component: src/components/alerts/alert-list.tsx
3. Filter component: src/components/alerts/alert-filters.tsx
4. Alert list page: src/app/dashboard/alerts/page.tsx
5. Updated dashboard navigation

**Next Steps:**
- Plan 02-03: Create alert detail view (click "Ver Detalhes" button)
- Plan 02-04: Add real-time updates to alert list

**User Actions Required:**
None - page is ready to use with seed data
