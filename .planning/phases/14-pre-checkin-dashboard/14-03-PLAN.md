---
phase: 14-pre-checkin-dashboard
plan: 03
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - src/components/pre-checkin/pre-checkin-table.tsx
  - src/components/pre-checkin/pre-checkin-cards.tsx
  - src/components/pre-checkin/pre-checkin-filters.tsx
  - src/components/pre-checkin/pre-checkin-pagination.tsx
  - src/components/pre-checkin/status-badge.tsx
  - src/components/pre-checkin/progress-bar.tsx
autonomous: true

must_haves:
  truths:
    - "Table displays Patient, Appointment, Service, Status, Progress, Actions columns"
    - "Status badges show correct colors: blue=pendente, yellow=em_andamento, green=completo, red=incompleto"
    - "Filters allow filtering by status, date range, and patient name search"
    - "Mobile view shows card layout instead of table"
    - "Progress bar shows percentage based on checklist completion"
  artifacts:
    - path: "src/components/pre-checkin/pre-checkin-table.tsx"
      provides: "Desktop table for pre-checkin list"
      exports: ["PreCheckinTable"]
    - path: "src/components/pre-checkin/pre-checkin-cards.tsx"
      provides: "Mobile cards for pre-checkin list"
      exports: ["PreCheckinCards"]
    - path: "src/components/pre-checkin/pre-checkin-filters.tsx"
      provides: "Filter controls for status, date, search"
      exports: ["PreCheckinFilters"]
    - path: "src/components/pre-checkin/pre-checkin-pagination.tsx"
      provides: "Pagination controls"
      exports: ["PreCheckinPagination"]
    - path: "src/components/pre-checkin/status-badge.tsx"
      provides: "Status badge component with color mapping"
      exports: ["StatusBadge", "STATUS_CONFIG"]
    - path: "src/components/pre-checkin/progress-bar.tsx"
      provides: "Progress bar showing checklist completion"
      exports: ["ProgressBar"]
  key_links:
    - from: "src/components/pre-checkin/pre-checkin-table.tsx"
      to: "src/components/pre-checkin/status-badge.tsx"
      via: "import StatusBadge"
      pattern: "import.*StatusBadge"
    - from: "src/components/pre-checkin/pre-checkin-filters.tsx"
      to: "useSearchParams"
      via: "next/navigation"
      pattern: "useSearchParams|useRouter"
---

<objective>
Create table, cards, filters, and pagination components for displaying and navigating pre-checkin records.

Purpose: Provide the main data display UI that staff will use to view, filter, and navigate pre-checkin records.
Output: Full set of presentation components that can be composed together in the dashboard.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-pre-checkin-dashboard/14-CONTEXT.md
@.planning/phases/14-pre-checkin-dashboard/14-RESEARCH.md
@.planning/phases/14-pre-checkin-dashboard/14-01-SUMMARY.md

Reference patterns:
@src/components/agenda/agenda-list-table.tsx
@src/components/agenda/agenda-list-cards.tsx
@src/components/agenda/agenda-list-filters.tsx
@src/components/agenda/agenda-list-pagination.tsx
@src/components/lembretes-enviados/lembrete-enviado-table.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StatusBadge and ProgressBar components</name>
  <files>src/components/pre-checkin/status-badge.tsx, src/components/pre-checkin/progress-bar.tsx</files>
  <action>
**Create src/components/pre-checkin/status-badge.tsx:**

1. 'use client' directive

2. Import Badge from @/components/ui/badge, cn from @/lib/utils, icons from lucide-react (Clock, CheckCircle, XCircle, Loader2)

3. Define STATUS_CONFIG constant:
```typescript
export const STATUS_CONFIG = {
  pendente: {
    label: 'Pendente',
    variant: 'secondary' as const,
    className: 'bg-blue-100 text-blue-800 hover:bg-blue-100',
    icon: Clock,
  },
  em_andamento: {
    label: 'Em Andamento',
    variant: 'secondary' as const,
    className: 'bg-yellow-100 text-yellow-800 hover:bg-yellow-100',
    icon: Loader2,
  },
  completo: {
    label: 'Completo',
    variant: 'secondary' as const,
    className: 'bg-green-100 text-green-800 hover:bg-green-100',
    icon: CheckCircle,
  },
  incompleto: {
    label: 'Incompleto',
    variant: 'secondary' as const,
    className: 'bg-red-100 text-red-800 hover:bg-red-100',
    icon: XCircle,
  },
} as const
```

4. Create StatusBadge component:
```typescript
interface StatusBadgeProps {
  status: keyof typeof STATUS_CONFIG
}

export function StatusBadge({ status }: StatusBadgeProps) {
  const config = STATUS_CONFIG[status]
  const Icon = config.icon

  return (
    <Badge variant={config.variant} className={config.className}>
      <Icon className="h-3 w-3 mr-1" />
      {config.label}
    </Badge>
  )
}
```

**Create src/components/pre-checkin/progress-bar.tsx:**

1. 'use client' directive

2. Import cn from @/lib/utils

3. Create ProgressBar component:
```typescript
interface ProgressBarProps {
  value: number  // 0-100
}

export function ProgressBar({ value }: ProgressBarProps) {
  return (
    <div className="flex items-center gap-2">
      <div className="flex-1 bg-gray-200 rounded-full h-2 overflow-hidden min-w-[60px]">
        <div
          className={cn(
            "h-full rounded-full transition-all duration-300",
            value === 100 && "bg-green-500",
            value >= 50 && value < 100 && "bg-yellow-500",
            value < 50 && "bg-blue-500"
          )}
          style={{ width: `${value}%` }}
        />
      </div>
      <span className="text-xs text-gray-600 font-medium min-w-[3ch] text-right">
        {value}%
      </span>
    </div>
  )
}
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>StatusBadge shows correct colors per status, ProgressBar shows percentage visually</done>
</task>

<task type="auto">
  <name>Task 2: Create PreCheckinTable and PreCheckinCards components</name>
  <files>src/components/pre-checkin/pre-checkin-table.tsx, src/components/pre-checkin/pre-checkin-cards.tsx</files>
  <action>
**Create src/components/pre-checkin/pre-checkin-table.tsx:**

1. 'use client' directive

2. Imports:
   - Table components from @/components/ui/table
   - Button from @/components/ui/button
   - StatusBadge, ProgressBar from same folder
   - PreCheckin type from @/lib/validations/pre-checkin
   - calculateProgress from @/lib/validations/pre-checkin
   - format from date-fns, ptBR locale
   - Icons: Eye, Bell, MoreHorizontal
   - DropdownMenu components for actions

3. Props interface:
```typescript
interface PreCheckinTableProps {
  data: PreCheckin[]
  onRowClick: (preCheckin: PreCheckin) => void
  onSendReminder: (preCheckin: PreCheckin) => void
}
```

4. Table structure with columns:
   - Paciente (patient name, phone below in smaller text)
   - Consulta (appointment date/time formatted as "dd/MM/yyyy HH:mm")
   - Servico (service name)
   - Status (StatusBadge component)
   - Progresso (ProgressBar component)
   - Acoes (dropdown with "Ver detalhes" and "Enviar lembrete")

5. Row click handler on entire row (except actions column)

6. Empty state when no data

**Create src/components/pre-checkin/pre-checkin-cards.tsx:**

1. 'use client' directive

2. Same props as table

3. Card layout for mobile:
   - Card header: Patient name + Status badge
   - Card body:
     - Appointment date/time
     - Service name
     - Progress bar
   - Card footer: Action buttons (Ver detalhes, Enviar lembrete)

4. Grid: single column on mobile

Use existing agenda-list-cards.tsx and agenda-list-table.tsx as patterns.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Table shows all required columns, cards show same data in mobile-friendly layout</done>
</task>

<task type="auto">
  <name>Task 3: Create PreCheckinFilters and PreCheckinPagination components</name>
  <files>src/components/pre-checkin/pre-checkin-filters.tsx, src/components/pre-checkin/pre-checkin-pagination.tsx</files>
  <action>
**Create src/components/pre-checkin/pre-checkin-filters.tsx:**

1. 'use client' directive

2. Imports:
   - useRouter, useSearchParams, usePathname from next/navigation
   - useState, useEffect, useCallback from react
   - Button, Input, Select, Popover, Calendar components from shadcn/ui
   - Icons: Filter, Search, X, Calendar as CalendarIcon
   - STATUS_CONFIG from ./status-badge
   - format, startOfDay, endOfDay from date-fns
   - debounce pattern (300ms for search)

3. Filter state managed via URL search params (not internal state)

4. Filters:
   a) **Status dropdown** - Select with options from STATUS_CONFIG plus "Todos" option
   b) **Date range** - Two date pickers (De/Ate) with Popover + Calendar
   c) **Search input** - Text input with 300ms debounce, searches by patient name
   d) **Quick filters** - Buttons: "Hoje", "Amanha", "Esta Semana", "Este Mes"
   e) **Clear all** - Button to reset all filters

5. URL param updates:
   - When filter changes, update URL with router.push
   - Preserve other params when changing one filter
   - Reset page to 1 when changing filters

6. Layout:
   - Quick filters row at top
   - Collapsible advanced filters section (status, date range, search)
   - Mobile: stack vertically
   - Desktop: horizontal layout

Follow agenda-list-filters.tsx pattern closely.

**Create src/components/pre-checkin/pre-checkin-pagination.tsx:**

1. 'use client' directive

2. Imports:
   - useRouter, useSearchParams, usePathname from next/navigation
   - Button from @/components/ui/button
   - Select for items per page
   - Icons: ChevronLeft, ChevronRight, ChevronsLeft, ChevronsRight

3. Props:
```typescript
interface PreCheckinPaginationProps {
  currentPage: number
  totalPages: number
  totalItems: number
  itemsPerPage: number
}
```

4. Features:
   - First/Prev/Next/Last buttons
   - Page indicator: "Pagina X de Y"
   - Items per page selector: 25, 50, 100
   - Total items count: "Mostrando X de Y"

5. URL param updates for page and limit

Follow agenda-list-pagination.tsx pattern.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Filters update URL params, pagination navigates pages, all components work together</done>
</task>

</tasks>

<verification>
1. All components compile without TypeScript errors
2. StatusBadge renders with correct colors for each status
3. ProgressBar shows visual progress (0%, 33%, 66%, 100%)
4. Table displays all required columns
5. Cards display same information in mobile-friendly format
6. Filters update URL search params correctly
7. Pagination changes page param in URL
8. Quick date filters set correct date ranges
</verification>

<success_criteria>
- PCHK-02: Table displays Patient, Appointment, Service, Status, Progress, Actions columns
- PCHK-03: Status badges use correct colors (blue/yellow/green/red)
- PCHK-04: Filter by status works
- PCHK-05: Filter by date range works
- PCHK-06: Search by patient name works
- PCHK-11: (partial) Progress calculation shown in table
- PCHK-13: Mobile responsive with card layout
</success_criteria>

<output>
After completion, create `.planning/phases/14-pre-checkin-dashboard/14-03-SUMMARY.md`
</output>
