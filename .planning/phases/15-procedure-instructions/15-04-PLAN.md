---
phase: 15-procedure-instructions
plan: 04
type: execute
wave: 4
depends_on: ["15-03"]
files_modified:
  - src/app/admin/pre-checkin/instrucoes/page.tsx
  - src/components/layout/sidebar.tsx
autonomous: false

must_haves:
  truths:
    - "Admin can navigate to instructions page from pre-checkin menu"
    - "Instructions page displays with all functionality working"
    - "Non-admin users cannot access the page"
  artifacts:
    - path: "src/app/admin/pre-checkin/instrucoes/page.tsx"
      provides: "Server component page for instructions management"
      min_lines: 40
  key_links:
    - from: "src/app/admin/pre-checkin/instrucoes/page.tsx"
      to: "src/components/instructions/instructions-page-client.tsx"
      via: "component import"
      pattern: "InstructionsPageClient"
    - from: "src/components/layout/sidebar.tsx"
      to: "/admin/pre-checkin/instrucoes"
      via: "navigation link"
      pattern: "/admin/pre-checkin/instrucoes"
---

<objective>
Integrate instructions page into the admin panel and add navigation.

Purpose: Make the instructions management page accessible to admins and verify the complete flow.
Output: Working admin page with navigation link from pre-checkin section.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/15-procedure-instructions/15-03-SUMMARY.md
@src/app/admin/servicos/page.tsx
@src/app/admin/pre-checkin/page.tsx
@src/components/layout/sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin page for instructions</name>
  <files>src/app/admin/pre-checkin/instrucoes/page.tsx</files>
  <action>
Create the admin page following the pattern from src/app/admin/servicos/page.tsx.

Structure:
1. Server component (no 'use client')
2. Parse searchParams (q, tipo, ativo, page, limit)
3. Suspense wrapper with TableSkeleton fallback

Page layout:
- Back button linking to /admin/pre-checkin
- Title: "Instrucoes de Procedimentos"
- Subtitle: "Gerencie as instrucoes enviadas aos pacientes via WhatsApp"
- InstructionsPageClient component with parsed params

searchParams interface:
- q?: string
- tipo?: string
- ativo?: string
- page?: string
- limit?: string

Parse page and limit to integers with defaults (1 and 20).

Note: RBAC is enforced by the admin layout, no additional check needed in page.
  </action>
  <verify>Page renders at /admin/pre-checkin/instrucoes without errors</verify>
  <done>Admin page exists and renders InstructionsPageClient with proper params</done>
</task>

<task type="auto">
  <name>Task 2: Add navigation link to sidebar</name>
  <files>src/components/layout/sidebar.tsx</files>
  <action>
Add a navigation link for "Instrucoes" under the Pre-Checkin section.

Location: Find the pre-checkin menu section (likely has link to /admin/pre-checkin)

Add new link:
- Label: "Instrucoes"
- Href: "/admin/pre-checkin/instrucoes"
- Icon: FileText from lucide-react

If Pre-Checkin has a submenu/accordion:
- Add Instrucoes as a child item

If it's a flat list:
- Add as a sibling under Pre-Checkin section

Maintain consistent styling with other sidebar items.
  </action>
  <verify>Sidebar shows "Instrucoes" link that navigates to correct page</verify>
  <done>Navigation link visible in sidebar under Pre-Checkin section</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete instructions management feature (INST-01 through INST-09)</what-built>
  <how-to-verify>
1. Navigate to http://localhost:3051/admin/pre-checkin/instrucoes
2. Verify page loads with table (may be empty initially)
3. Click "Nova Instrucao" to open form
4. Fill out form:
   - Titulo: "Preparacao para Limpeza de Pele"
   - Tipo: Preparo
   - Servico: (select any or "Geral")
   - Conteudo: "Ola {nome_paciente}! Seguem as instrucoes para sua consulta em {data_consulta}. Por favor chegue 15 minutos antes."
5. Watch WhatsApp preview update live as you type
6. Check character count appears below preview
7. Save and verify instruction appears in list
8. Edit the instruction - verify form populates
9. Test deactivate - confirm dialog, then check status changes
10. Test search - type in search box, verify filtering
11. Test type filter - select a type, verify list filters

Non-admin test (optional):
- Log in as ATENDENTE role
- Try to access /admin/pre-checkin/instrucoes
- Should see 403 or redirect
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Page accessible at /admin/pre-checkin/instrucoes
2. Navigation link visible in sidebar
3. All CRUD operations work (create, read, update, deactivate)
4. WhatsApp preview shows realistic formatting
5. Search and filters work correctly
6. ADMIN-only access enforced
</verification>

<success_criteria>
- [INST-01] List displays all instructions
- [INST-02] Search works by title
- [INST-03] Create form opens and saves
- [INST-04] Form has all required fields
- [INST-05] Type dropdown shows all 7 types
- [INST-06] Edit updates existing instruction
- [INST-07] Deactivate sets ativo=false
- [INST-08] WhatsApp preview shows formatted message
- [INST-09] Only ADMIN can access page
</success_criteria>

<output>
After completion, create `.planning/phases/15-procedure-instructions/15-04-SUMMARY.md`
</output>
